"use strict";(()=>{var N=e=>{let{stage:s,buildings:n}=a;switch(e){case"discharge":a.energy.current=0,n[0].current=3;break;case"vaporization":n[0].current=.0028;for(let r=0;r<3;r++)a.upgrades[r]=0,$(r);for(let r=0;r<o.researchesS2Info.cost.length;r++)a.researches[r]=0,$(r,"researches"),M(r,"researches");break;case"stage":{a.upgrades=[],a.researches=[];let{upgrades:r,researches:i}=a;for(let l=1;l<p.buildings.length;l++)n[l].current=0,n[l].true=0,n[l].total=0,n[l].trueTotal=0;let c="upgradesInfo",u="researchesInfo";s.current!==1&&(c=`upgradesS${s.current}Info`,u=`researchesS${s.current}Info`);for(let l=0;l<o[c].cost.length;l++)r[l]=0;for(let l=0;l<o[u].cost.length;l++)i[l]=0;switch(s.current){case 1:n[0].current=3,a.energy.current=0,a.energy.total=0,a.discharge.current=0;break;case 2:n[0].current=.0028,a.vaporization.current=0,a.vaporization.clouds=1;break}n[0].total=n[0].current,n[0].trueTotal=n[0].current,D(),R(),O();break}}if(e!=="stage"){n[0].total=n[0].current;for(let r=1;r<p.buildings.length;r++)n[r].current=0,n[r].true=0,n[r].total=0,w(r)}S()};var I=(e,s=!1)=>{let{stage:n,buildings:r}=a,{buildingsInfo:i,screenReader:c}=o;if(!isFinite(i.cost[e])){c&&!s&&(t("invisibleBought").textContent=`Coudn't buy '${i.name[e]}', because cost is infinity`);return}let u=e-1;n.current===2&&e>2&&(u=1);let l=2;if(n.current===2&&(l=1),r[u].current<i.cost[e]*(s?l:1)){c&&!s&&(t("invisibleBought").textContent=`Coudn't buy '${i.name[e]}', because didn't had enough of '${i.name[u]}'`);return}let{researchesAuto:g,buyToggle:y}=a;if(n.current===1&&(o.energyType[e]=v.energyType[e]*3**a.researches[4]),y.howMany!==1&&g[0]>0||s){let h=r[u].current;s&&(h/=l);let m=i.cost[e],Q=0,H=s?-1:y.howMany;for(var f=0;h>=m&&f!==H;f++)Q+=m,h-=m,m*=i.increase;if(f<H&&H!==-1&&y.strict)return;r[u].current-=Q,r[e].current+=f,r[e].true+=f,r[e].total+=f,r[e].trueTotal+=f,n.current===1&&(a.energy.current+=o.energyType[e]*f,a.energy.total+=o.energyType[e]*f),o.screenReader&&!s&&(t("invisibleBought").textContent=`Bought ${d(f)} '${i.name[e]}'${n.current===1?`, gained ${d(o.energyType[e]*f)} ${o.stageInfo.resourceName[n.current-1]}`:""}`)}else(y.howMany===1||g[0]===0)&&(r[u].current-=i.cost[e],r[e].current++,r[e].true++,r[e].total++,r[e].trueTotal++,n.current===1&&(a.energy.current+=o.energyType[e],a.energy.total+=o.energyType[e]),o.screenReader&&(t("invisibleBought").textContent=`Bought 1 '${i.name[e]}'${n.current===1?`, gained ${o.energyType[e]} ${o.stageInfo.resourceName[n.current-1]}`:""}`));w(e),W(),S()},w=e=>{let{stage:s,buildings:n,upgrades:r,researches:i}=a,{buildingsInfo:c}=o;s.current===1&&(o.upgradesInfo.effect[4]=Math.trunc((.2+i[0]*.01)*100)/100,c.increase=Math.trunc((1.4-(r[4]===1?o.upgradesInfo.effect[4]:0))*100)/100),c.cost[e]=v.buildingsInfo.cost[e]*c.increase**n[e].true,s.current===1&&e===1&&r[0]===1&&(c.cost[1]/=10)},M=(e,s)=>{let{stage:n}=a,r="researchesAutoInfo";s!=="researchesAuto"&&(r=`${s}${n.current>1?`S${n.current}`:""}Info`),a[s][e]!==o[r].max[e]&&(n.current===1?o[r].cost[e]=v[r].cost[e]+o[r].scalling[e]*a[s][e]:(o[r].cost[e]=Math.trunc(v[r].cost[e]*o[r].scalling[e]**a[s][e]),r==="researchesAutoInfo"&&n.current===2&&e===1&&a.researchesAuto[1]>=3&&(o[r].cost[e]*=a.researchesAuto[1]>=4?1e3:100)))},L=(e,s)=>{let{stage:n,buildings:r,upgrades:i}=a,{buildingsInfo:c}=o,u=r[e].current,l;if(n.current===1&&e===3){if(c.producing[3]<=1)return;l=Math.log(c.producing[e])*s*12**a.researches[2],i[7]===1&&(l*=a.energy.current)}else l=c.producing[e+1]*s,n.current===2&&e===1&&i[4]===1&&(l+=a.vaporization.clouds*s/1e3);if(l===0)return;let g=r[e].current+l;if(isFinite(g))r[e].current=g;else return;if(g=r[e].total+(r[e].current-u),isFinite(g))r[e].total=g;else return;g=r[e].trueTotal+(r[e].current-u),isFinite(g)&&(r[e].trueTotal=g)},x=(e,s="upgrades")=>{let{stage:n}=a,r;if(n.current===1?r=a.energy:r=a.buildings[1],s!=="upgrades"){let i="researchesAutoInfo";if(s!=="researchesAuto"&&(i=`${s}${n.current>1?`S${n.current}`:""}Info`),s==="researchesAuto"&&n.current===1&&e>1||a[s][e]===o[i].max[e]||r.current<o[i].cost[e])return;if(a[s][e]++,r.current-=o[i].cost[e],n.current===1&&s==="researches"&&e===0)for(let c=1;c<o.buildingsInfo.name.length;c++)w(c);o.screenReader&&(t("invisibleBought").textContent=`You have researched '${o[i].description[e]}', level is now ${a[s][e]} ${a[s][e]===o[i].max[e]?"maxed":""}`),M(e,s)}else{let i=`${s}${n.current>1?`S${n.current}`:""}Info`;if(a[s][e]===1||r.current<o[i].cost[e])return;if(a[s][e]=1,r.current-=o[i].cost[e],n.current===1){if(e===0)w(1);else if(e===3)t("discharge").style.display="";else if(e===4)for(let c=1;c<o.buildingsInfo.name.length;c++)w(c)}o.screenReader&&(t("invisibleBought").textContent=`You have bought upgrade '${o[i].description[e]}'`)}S(),k(e,s),$(e,s)},Y=(e,s=!0)=>{var i,c,u,l;let{toggles:n}=a,r=t(`toggle${e}`);s&&(n[e]=!n[e]),r.classList.contains("auto")?n[e]?(r.textContent="Auto ON",r.style.borderColor=""):(r.textContent="Auto OFF",r.style.borderColor="crimson"):n[e]?(r.textContent="ON",r.style.borderColor="",o.screenReader&&(r.ariaLabel=(l=(u=r.ariaLabel)==null?void 0:u.replace(" OFF"," ON"))!=null?l:"")):(r.textContent="OFF",r.style.borderColor="crimson",o.screenReader&&(r.ariaLabel=(c=(i=r.ariaLabel)==null?void 0:i.replace(" ON"," OFF"))!=null?c:""))},E=(e="none")=>{let{buyToggle:s}=a,n=t("buyAnyInput");switch(e){case"1":s.howMany=1;break;case"max":s.howMany=-1;break;case"any":s.input=Math.max(Math.trunc(Number(n.value)),-1),s.input===0&&(s.input=1),s.howMany=s.input;break;case"strict":s.strict=!s.strict;break;default:n.value=String(s.input)}t("buyStrict").style.borderColor=s.strict?"":"crimson",t("buy1x").style.backgroundColor=s.howMany===1?"green":"",t("buyAny").style.backgroundColor=Math.abs(s.howMany)!==1?"green":"",t("buyMax").style.backgroundColor=s.howMany===-1?"green":""},_=async()=>{let{stage:e,buildings:s,researchesAuto:n,toggles:r}=a,i=!1;if(e.current===1){if(s[3].current>=167e19){let c=!0;r[2]&&(c=await C("I kinda mess up, with next stage... You can play it, but it will be reworked. Progress in next stage is going to be completely wiped, when I'm done")),c&&(n[0]===0&&n[0]++,i=!0)}}else s[1].current>=268e24&&b("Not yet in game. When new stage is out, progress is going to be fully reset again");i&&(n[1]=0,e.current++,e.true<e.current&&e.true++,N("stage"))},K=async()=>{let{energy:e}=a,{dischargeInfo:s}=o;if(a.upgrades[3]===1&&a.buildings[1].true>0&&a.stage.current===1){let n=!0;a.toggles[1]&&e.current<s.next?n=await C("This will reset all of your current buildings and energy. You will NOT gain production boost. Continue?"):a.toggles[1]&&e.current>=s.next&&(n=await C("You have enough energy to gain boost. Continue?")),n&&(e.current>=s.next?(a.discharge.current++,s.next*=10,o.screenReader&&(t("invisibleBought").textContent="Buildings and energy were reset for some boost")):o.screenReader&&e.current<s.next&&(t("invisibleBought").textContent="Buildings and energy were reset, no boost"),N("discharge"))}},X=async()=>{let{vaporizationInfo:e}=o;if(a.upgrades[3]===1&&e.get>=1&&a.stage.current===2){let{vaporization:s}=a,n=!0;a.toggles[9]&&(n=await C(`Do you wish to reset buildings, upgrades and researches for ${d(e.get)} Clouds?`)),n&&(s.current++,s.clouds+=e.get,N("vaporization"),o.screenReader&&(t("invisibleBought").textContent=`Progress were reset for ${d(e.get)} Clouds`))}};var A=(e="none")=>{if(o.tab!==e){t("stageTab").style.display="none",t("stageTabBtn").style.borderColor="",t("researchTab").style.display="none",t("researchTabBtn").style.borderColor="",t("settingsTab").style.display="none",t("settingsTabBtn").style.borderColor="";let s=["#e3e3e3","#a10000"][o.theme.stage-1],n=t("invisibleTab");t("specialTab").style.display="none",e!=="none"?o.tab=e:o.tab="stage",t(`${o.tab}Tab`).style.display="",t(`${o.tab}TabBtn`).style.borderColor=s,n.textContent=`Current tab: ${o.tab} tab`,R(),S()}},W=()=>{let{stage:e,time:s,buildings:n,upgrades:r,researches:i,researchesAuto:c,toggles:u}=a,{timeSpecial:l,buildingsInfo:g}=o,y=Date.now()-s.updated,f=y/1e3;if(s.updated=Date.now(),y<0)return console.warn("Negative passed time detected.");if(l.lastSave+=y,l.maxOffline=3600,c[2]>0&&(l.maxOffline+=3600*c[2]),f>l.maxOffline&&(f=l.maxOffline,console.log(`Max offline progress is ${l.maxOffline/3600} hours.`)),e.current===1){let{discharge:h}=a,{upgradesInfo:m}=o;u[6]&&c[1]>=3&&I(3,!0),g.producing[3]=.3*n[3].current*m.effect[3]**h.current,r[5]===1&&(g.producing[3]*=m.effect[5]**n[3].true),L(2,f),m.effect[5]=Math.trunc((1.02+.01*i[1])*100)/100,m.effect[3]=4+1*i[3],r[6]===1&&L(3,f),u[5]&&c[1]>=2&&I(2,!0),g.producing[2]=.4*n[2].current*m.effect[3]**h.current,r[2]===1&&(g.producing[2]*=5),r[5]===1&&(g.producing[2]*=m.effect[5]**n[2].true),L(1,f),u[4]&&c[1]>=1&&I(1,!0),g.producing[1]=.5*n[1].current*m.effect[3]**h.current,r[1]===1&&(g.producing[1]*=10),r[5]===1&&(g.producing[1]*=m.effect[5]**n[1].true),L(0,f)}else if(e.current===2){let{vaporizationInfo:h,upgradesS2Info:m}=o;u[8]&&c[1]>=5&&I(5,!0),g.producing[5]=2*n[5].current,r[5]===1&&(g.producing[5]*=a.vaporization.clouds**.05),u[7]&&c[1]>=4&&I(4,!0),g.producing[4]=2*n[4].current,r[2]===1&&(g.producing[4]*=Math.log10(n[2].current)),n[5].current>=1&&(g.producing[4]*=g.producing[5]),u[6]&&c[1]>=3&&I(3,!0),g.producing[3]=2*n[3].current,r[1]===1&&(g.producing[3]*=1.5),n[4].current>=1&&(g.producing[3]*=g.producing[4]),u[5]&&c[1]>=2&&I(2,!0),g.producing[2]=2*n[2].current*a.vaporization.clouds,m.effect[0]=1.03+i[2]*.01,r[0]===1&&(g.producing[2]*=m.effect[0]**n[2].true),n[3].current>=1&&(g.producing[2]*=g.producing[3]),i[1]>=1&&n[1].true>1&&(g.producing[2]*=Math.log10(n[1].true)),L(1,f),n[0].current<.0028&&n[1].current===0&&(n[0].current=.0028),n[1].current<n[1].true&&(n[1].true=Math.trunc(n[1].current),w(1)),u[4]&&c[1]>=1&&I(1,!0),g.producing[1]=4e-4*n[1].current,i[0]>0&&(g.producing[1]*=3**i[0]),L(0,f),h.get=n[1].total/1e10,h.get>1e5&&(h.get=1e5+(h.get-1e5)**.65),h.get>1e7&&(h.get=1e7+(h.get-1e7)**.8)}},S=()=>{let{stage:e,buildings:s,upgrades:n}=a,{tab:r,buildingsInfo:i}=o;if(o.footer&&(e.current===1?(t("quarks").textContent=`Quarks: ${d(s[0].current)}`,a.energy.total>=9&&(t("energy").textContent=`Energy: ${d(a.energy.current,0)}`)):e.current===2&&(t("water").textContent=`Moles: ${d(s[0].current)}`,r!=="stage"&&(t("dropExtra").textContent=`Drops: ${d(s[1].current)}`),n[3]===1&&(t("clouds").textContent=`Clouds: ${d(a.vaporization.clouds)}`))),r==="stage"){for(let c=1;c<i.name.length;c++){t(`building${c}Cur`).textContent=d(s[c].current),t(`building${c}Prod`).textContent=d(i.producing[c]);let u=c-1;e.current===2&&c>2&&(u=1),i.cost[c]<=s[u].current?(t(`building${c}Btn`).classList.add("availableBuilding"),t(`building${c}Btn`).textContent=`Buy for: ${d(i.cost[c])} ${i.name[u]}`):(t(`building${c}Btn`).classList.remove("availableBuilding"),t(`building${c}Btn`).textContent=`Need: ${d(i.cost[c])} ${i.name[u]}`)}e.current===1?n[3]===1&&(t("dischargeReset").textContent=`Next goal is ${d(o.dischargeInfo.next,0)} Energy`,t("dischargeEffect").textContent=String(o.upgradesInfo.effect[3])):e.current===2&&n[3]===1&&(t("vaporizationReset").textContent=`Reset for ${d(o.vaporizationInfo.get)} Clouds`)}else r==="settings"&&o.timeSpecial.lastSave>=1e3&&(t("isSaved").textContent=`${d(o.timeSpecial.lastSave,0,"time")} ago`)},R=()=>{let{stage:e,buildings:s,upgrades:n,researchesAuto:r}=a,{screenReader:i}=o;if(e.current===1){let{energy:c,discharge:u}=a;t("energyStat").style.display=c.total>=9?"":"none",t("discharge").style.display=n[3]===1?"":"none",s[1].trueTotal>=11&&(t("building2").style.display=""),s[2].trueTotal>=2&&(t("building3").style.display=""),c.total>=9&&(t("upgrades").style.display=""),u.current>=1&&(t("resetToggles").style.display="");for(let l=5;l<=8;l++)t(`upgrade${l}`).style.display=u.current>=3?"":"none";u.current>=4&&(t("researchTabBtn").style.display=""),n[7]===1&&(t("stage").style.display=""),s[3].current>=167e19&&(t("stageReset").textContent="Enter next stage"),i&&(t("invisibleGetResource1").style.display=c.total>0?"":"none")}else if(e.current===2){let{vaporization:c}=a;t("dropStat").style.display=o.tab!=="stage"?"":"none",t("cloudStat").style.display=n[3]===1?"":"none",t("vaporization").style.display=n[3]===1?"":"none",t("vaporizationToggleReset").style.display=c.current>0?"":"none",s[2].trueTotal>=1&&(t("upgrades").style.display=""),t("upgradeW2").style.display=s[3].trueTotal>=1?"":"none",t("upgradeW3").style.display=s[4].trueTotal>=1?"":"none",t("upgradeW4").style.display=s[3].trueTotal>=1?"":"none",t("upgradeW5").style.display=c.current>0?"":"none",t("upgradeW6").style.display=s[5].trueTotal>=1?"":"none",t("researchW3").style.display=s[2].trueTotal>=1?"":"none",s[1].trueTotal>=400&&(t("building2").style.display=""),s[1].trueTotal>=1e7&&(t("building3").style.display=""),s[1].trueTotal>=1e18&&(t("building4").style.display=""),s[1].trueTotal>=1e23&&(t("building5").style.display=""),s[1].current>=268e24&&(t("stageReset").textContent="Enter next stage"),i&&(t("invisibleGetResource1").style.display=n[3]===1?"":"none")}for(let c=1;c<p.buildings.length;c++)t(`toggle${c+3}`).style.display=r[1]>=c?"":"none";t("toggleBuy").style.display=r[0]>0?"":"none",i&&(t("invisibleGetBuilding2").style.display=s[2].trueTotal>0?"":"none",t("invisibleGetBuilding3").style.display=s[3].trueTotal>0?"":"none",t("invisibleGetBuilding4").style.display=s[4].trueTotal>0?"":"none",t("invisibleGetBuilding5").style.display=s[5].trueTotal>0?"":"none")},k=(e,s="upgrades")=>{let{stage:n}=a;if(s!=="upgrades"){let r="researchesAutoInfo";s!=="researchesAuto"&&(r=`${s}${n.current>1?`S${n.current}`:""}Info`),t("researchText").textContent=o[r].description[e],s==="researchesAuto"&&e===1&&(o.researchesAutoInfo.effect[1]=o.buildingsInfo.name[Math.min(a.researchesAuto[1]+1,o.buildingsInfo.name.length-1)]),o[r].effect[e]!==0?t("researchEffect").textContent=`${o[r].effectText[e][0]}${d(o[r].effect[e])}${o[r].effectText[e][1]}`:t("researchEffect").textContent=o[r].effectText[e][0],t("researchCost").textContent=`${a[s][e]===o[r].max[e]?0:d(o[r].cost[e])} ${o.stageInfo.priceName[a.stage.current-1]}.`}else{let r=`${s}${n.current>1?`S${n.current}`:""}Info`;t("upgradeText").textContent=o[r].description[e],o[r].effect[e]!==0?t("upgradeEffect").textContent=`${o[r].effectText[e][0]}${d(o[r].effect[e])}${o[r].effectText[e][1]}`:t("upgradeEffect").textContent=o[r].effectText[e][0],t("upgradeCost").textContent=`${a[s][e]===1?0:d(o[r].cost[e])} ${o.stageInfo.priceName[a.stage.current-1]}.`}},$=(e,s="upgrades")=>{let{stage:n}=a,r="researchesAutoInfo";s!=="researchesAuto"&&(r=`${s}${n.current>1?`S${n.current}`:""}Info`);let i="";n.current===2&&(i="W");let c;if(s==="researchesAuto"?c=t(`researchAuto${e+1}Level`):s==="researches"?c=t(`research${i}${e+1}Level`):c=t(`upgrade${i}${e+1}`),Object.prototype.hasOwnProperty.call(o[r],"max"))c.textContent=String(a[s][e]),c.classList.remove("redText","orchidText","greenText"),a[s][e]===o[r].max[e]?c.classList.add("greenText"):a[s][e]===0?c.classList.add("redText"):c.classList.add("orchidText");else{let u="green";n.current===2&&(u="darkgreen"),t(`upgrade${i}${e+1}`).style.backgroundColor=a[s][e]===1?u:""}},d=(e,s=e<1e3?e<1?4:2:0,n="number")=>{if(typeof e!="number")return e;switch(n){case"number":if(s>0&&e<1e6)return String(Math.trunc(e*10**s)/10**s);if(s<=0&&e<1e6)return String(Math.trunc(e));{let r=Math.trunc(Math.log10(e));return`${Math.trunc(e/10**r*100)/100}e${r}`}case"time":return e>=1728e5?`${Math.trunc(e/864e5)} days`:e>=72e5?`${Math.trunc(e/36e5)} hours`:e>=6e5?`${Math.trunc(e/6e4)} minutes`:`${Math.trunc(e/1e3)} seconds`}},D=()=>{let{stage:e}=a,{stageInfo:s,buildingsInfo:n,researchesAutoInfo:r}=o;for(let l=2;l<p.buildings.length;l++)t(`building${l}`).style.display="none";t("upgradeText").textContent="Hover to see.",t("upgradeEffect").textContent="Hover to see.",t("upgradeCost").textContent="Resource.",t("researchText").textContent="Hover to see.",t("researchEffect").textContent="Hover to see.",t("researchCost").textContent="Resource.",t("quarkStat").style.display=e.current===1?"":"none",t("particles").style.display=e.current===1?"":"none",t("atoms").style.display=e.current===1?"":"none",t("molecules").style.display=e.current===1?"":"none",t("dischargeToggleReset").style.display=e.current===1?"":"none";for(let l=1;l<=o.researchesInfo.cost.length;l++)t(`research${l}`).style.display=e.current===1?"":"none";if(t("waterStat").style.display=e.current===2?"":"none",t("drops").style.display=e.current===2?"":"none",t("puddles").style.display=e.current===2?"":"none",t("ponds").style.display=e.current===2?"":"none",t("lakes").style.display=e.current===2?"":"none",t("seas").style.display=e.current===2?"":"none",t("researchAuto3").style.display=e.current>=2?"":"none",t("upgrades").style.display="none",t("resetToggles").style.display=e.true>1?"":"none",t("researchTabBtn").style.display=e.true>1?"":"none",t("stage").style.display=e.true>1?"":"none",t("stageToggleReset").style.display=e.true>1?"":"none",t("themeArea").style.display=e.true>1||localStorage.getItem("theme")!==null?"":"none",t("switchTheme2").style.display=e.true>1?"":"none",e.current===1){n.name=["Quarks","Particles","Atoms","Molecules"],v.buildingsInfo.cost=[0,3,24,3],v.researchesAutoInfo.cost[1]=3e3,r.scalling[1]=5e3,o.dischargeInfo.next=10**a.discharge.current;for(let l=1;l<=4;l++)t(`upgrade${l}`).style.display=""}else if(e.current===2){n.name=["Moles","Drops","Puddles","Ponds","Lakes","Seas"],n.increase=1.2,v.buildingsInfo.cost=[0,.0028,100,1e7,1e18,1e23],v.researchesAutoInfo.cost[1]=1e10,r.scalling[1]=1e3,t("upgradeW1").style.display="";for(let l=1;l<=2;l++)t(`researchW${l}`).style.display=""}for(let l=1;l<n.name.length;l++)t(`building${l}Name`).textContent=n.name[l],w(l);let i=`upgrades${e.current>1?`S${e.current}`:""}Info`,c=`researches${e.current>1?`S${e.current}`:""}Info`;for(let l=0;l<o[i].cost.length;l++)a.upgrades[l]>1&&(a.upgrades[l]=1,console.error(`Upgrade (${l+1}) had an illegal value`)),$(l,"upgrades");for(let l=0;l<o[c].cost.length;l++)a.researches[l]>o[c].max[l]&&(a.researches[l]=o[c].max[l],console.error(`Research (${l+1}) had level above maxium`)),M(l,"researches"),$(l,"researches");r.max[1]=n.name.length-1;for(let l=0;l<r.cost.length;l++)a.researchesAuto[l]>o.researchesAutoInfo.max[l]&&(a.researchesAuto[l]=o.researchesAutoInfo.max[l],console.error(`Research (${l+1}) for automatization had level above maxium`)),M(l,"researchesAuto"),$(l,"researchesAuto");if(t("researchAuto2Max").textContent=String(r.max[1]),e.current!==1){t("energyStat").style.display="none",t("discharge").style.display="none";for(let l=1;l<=o.upgradesInfo.cost.length;l++)t(`upgrade${l}`).style.display="none"}if(e.current!==2){t("dropStat").style.display="none",t("cloudStat").style.display="none",t("vaporization").style.display="none",t("vaporizationToggleReset").style.display="none";for(let l=1;l<=o.upgradesS2Info.cost.length;l++)t(`upgradeW${l}`).style.display="none";for(let l=1;l<=o.researchesS2Info.cost.length;l++)t(`researchW${l}`).style.display="none"}let u=document.body.style;if(t("stageReset").textContent="You are not ready",t("stageWord").textContent=s.word[e.current-1],e.current===1?(u.removeProperty("--border-image"),u.removeProperty("--border-stage"),u.removeProperty("--stage-text-color")):(u.setProperty("--border-image",`url(Used_art/Stage${e.current}%20border.png)`),e.current===2&&(u.setProperty("--border-stage","#1460a8"),u.setProperty("--stage-text-color","dodgerblue"))),o.screenReader){t("invisibleBought").textContent=`Current stage is '${s.word[e.current-1]}'`,t("invisibleGetResource1").textContent=`Get information for ${s.resourceName[e.current-1]}`;for(let l=0;l<n.name.length;l++)t(`invisibleGetBuilding${l}`).textContent=`Get information for ${n.name[l]}`}};var j=(e,s=!1)=>{let{theme:n}=o;s?(n.default=!0,localStorage.removeItem("theme")):(n.default=!1,n.stage=e,localStorage.setItem("theme",String(e))),O()},O=()=>{let{stage:e}=a,{stageInfo:s,theme:n}=o,r=document.body.style;switch(r.setProperty("--transition","1s"),n.default?(n.stage=e.current,t("currentTheme").textContent="Default"):t("currentTheme").textContent=s.word[n.stage-1],t("upgradeCost").classList.remove("orangeText","cyanText"),t("researchCost").classList.remove("orangeText","cyanText"),r.removeProperty("--background-color"),r.removeProperty("--window-color"),r.removeProperty("--window-border"),r.removeProperty("--footer-color"),r.removeProperty("--button-main-color"),r.removeProperty("--button-main-border"),r.removeProperty("--button-main-hover"),r.removeProperty("--button-extra-hover"),r.removeProperty("--main-text-color"),r.removeProperty("--blue-text-color"),r.removeProperty("--gray-text-color"),n.stage){case 1:t("upgradeCost").classList.add("orangeText"),t("researchCost").classList.add("orangeText");break;case 2:t("upgradeCost").classList.add("cyanText"),t("researchCost").classList.add("cyanText"),r.setProperty("--background-color","#070026"),r.setProperty("--window-color","#000052"),r.setProperty("--window-border","blue"),r.setProperty("--footer-color","#0000db"),r.setProperty("--button-main-color","blue"),r.setProperty("--button-main-border","#427be1"),r.setProperty("--button-main-hover","#1515cf"),r.setProperty("--button-extra-hover","#2400d7"),r.setProperty("--main-text-color","dodgerblue"),r.setProperty("--blue-text-color","#82cb3b"),r.setProperty("--gray-text-color","#9b9b9b");break}setTimeout(()=>{r.removeProperty("--transition")},1e3)},b=e=>{let s=t("blocker");if(t("blocker").style.display==="block")return console.warn("Wasn't able to show another window (alert)");t("alertText").textContent=e;let n=t("confirmBtn");s.style.display="block";let r=()=>{s.style.display="none",n.removeEventListener("click",r)};n.addEventListener("click",r)},C=async e=>await new Promise(s=>{let n=t("blocker");n.style.display==="block"&&(console.warn("Wasn't able to show another window (confirm)"),s(!1)),t("alertText").textContent=e;let r=t("cancelBtn"),i=t("confirmBtn");n.style.display="block",r.style.display="block";let c=async()=>{n.style.display="none",r.style.display="none",i.removeEventListener("click",c),r.removeEventListener("click",u),s(!0)},u=async()=>{n.style.display="none",r.style.display="none",i.removeEventListener("click",c),r.removeEventListener("click",u),s(!1)};i.addEventListener("click",c),r.addEventListener("click",u)}),q=async e=>await new Promise(s=>{let n=t("blocker");n.style.display==="block"&&(console.warn("Wasn't able to show another window (prompt)"),s(null)),t("alertText").textContent=e;let r=t("inputArea"),i="",c=t("cancelBtn"),u=t("confirmBtn");n.style.display="block",c.style.display="block",r.style.display="block";let l=()=>{i=r.value},g=async()=>{n.style.display="none",c.style.display="none",r.style.display="none",r.value="",u.removeEventListener("click",g),c.removeEventListener("click",y),r.removeEventListener("blur",l),s(i)},y=async()=>{n.style.display="none",c.style.display="none",r.style.display="none",r.value="",u.removeEventListener("click",g),c.removeEventListener("click",y),r.removeEventListener("blur",l),s(null)};u.addEventListener("click",g),c.addEventListener("click",y),r.addEventListener("blur",l)}),F=()=>{let e=t("footer"),s=t("footerColor"),n=t("hideToggle"),r=t("hideText"),i=t("hideArrow");o.footer=!o.footer,n.removeEventListener("click",F),o.footer?(s.style.display="",i.style.transform="",e.style.animation="hide 1s forwards reverse",i.style.animation="rotate 1s forwards reverse",r.textContent="Hide"):(e.style.animation="hide 1s backwards",i.style.animation="rotate 1s backwards",r.textContent="Show",setTimeout(()=>{s.style.display="none",i.style.transform="rotate(180deg)"},1e3)),setTimeout(()=>{e.style.animation="",i.style.animation="",n.addEventListener("click",F)},1e3)},z=(e=!1,s="toggle",n="building")=>{var r;switch(s){case"toggle":{let i=e,c=Boolean((r=localStorage.getItem("screen reader"))!=null?r:!1),u=t("screenReaderToggle");i&&(c=!c),c?(u.textContent="ON",u.style.borderColor="crimson",u.setAttribute("aria-label","Screen reader support is ON"),localStorage.setItem("screen reader","true"),o.screenReader=!0,n==="reload"&&(a.buyToggle.strict=!1,o.intervals.main=100,o.intervals.numbers=1e3),i&&b(`For full support please refresh page. This will allow to buy upgrades on focus (because I have no idea how to make an image clickable with a keyboard), also you will get a special tab where you can check how much you own and more.
(For non screen readers this will cause issues)`)):(u.textContent="OFF",u.style.borderColor="",u.setAttribute("aria-label","Screen reader support is OFF"),localStorage.removeItem("screen reader"),o.screenReader=!1);break}case"button":{let i=e,{stage:c}=a,u=t("invisibleBought");if(n==="building"){let{buildings:l}=a,{buildingsInfo:g}=o,y=i-1;c.current===2&&i>2&&(y=1),i===0?u.textContent=`You have ${d(l[0].current)} ${g.name[0]}`:u.textContent=`You have ${d(l[i].current)} ${g.name[i]}, next one will cost ${d(g.cost[i])} ${g.name[y]}, they are producing ${d(g.producing[i])} ${g.name[y]} per second${a.researchesAuto[1]>=i?`, auto is ${a.toggles[i+3]?"on":"off"}`:""}`}else c.current===1?u.textContent=`You have ${a.energy.current} Energy${a.upgrades[3]===1?`, next discharge goal is ${d(o.dischargeInfo.next)} Energy`:""}`:c.current===2&&(u.textContent=`You have ${a.vaporization.clouds} Clouds`);break}}},U=(e=!1)=>{let s=document.body.style,n=t("customFontSize"),r=localStorage.getItem("fontSize");a.toggles[3]?((r===null||Number(r)<10||Number(r)>32||e)&&(r=String(Math.min(Math.max(Math.trunc(Number(n.value)*10)/10,10),32)),localStorage.setItem("fontSize",r)),s.setProperty("--font-size",`${r}px`),n.value=r):(s.setProperty("--font-size","1em"),localStorage.removeItem("fontSize"))};var a={version:"0.0.0",stage:{true:1,current:1},energy:{current:0,total:0},discharge:{current:0,bonus:0},vaporization:{current:0,clouds:1},time:{updated:Date.now(),started:Date.now()},buildings:[{current:3,total:3,trueTotal:3},{current:0,true:0,total:0,trueTotal:0},{current:0,true:0,total:0,trueTotal:0},{current:0,true:0,total:0,trueTotal:0},{current:0,true:0,total:0,trueTotal:0},{current:0,true:0,total:0,trueTotal:0}],upgrades:[0,0,0,0,0,0,0,0],researches:[0,0,0,0,0],researchesAuto:[0,0,0],toggles:[],buyToggle:{howMany:1,input:10,strict:!0}},o={tab:"stage",footer:!0,screenReader:!1,versionChanged:!1,energyType:[0,1,5,20],timeSpecial:{lastSave:0,maxOffline:3600},stageInfo:{word:["Microworld","Submerged"],priceName:["Energy","Drops"],resourceName:["Energy","Clouds"]},theme:{stage:1,default:!0},dischargeInfo:{next:1},vaporizationInfo:{get:0},intervals:{main:50,numbers:50,visual:1,autoSave:180},intervalsId:{main:0,numbers:0,visual:0,autoSave:0},buildingsInfo:{name:["Quarks","Particles","Atoms","Molecules"],cost:[0,3,24,3],increase:1.4,producing:[0,0,0,0,0,0]},upgradesInfo:{description:["Bigger electrons. Particles cost decreased.","Stronger protons. Particles produce more.","More neutrons. Increased gain of Particles.","Superposition. Unlocks new reset tier.","Protium. Basic.","Deuterium. Heavy.","Tritium. Radioactive.","Nuclear fusion. More energy."],effectText:[["Particle cost is "," times cheaper."],["Particles produce "," times more Quarks."],["Atoms produce "," times more Particles."],["Abbility to reset at any time and boost production for all buildings by ",", if had enough energy."],["Cost scalling is decreased by ","."],["Buildings (only bought one's) boost themselfs by "," times."],["Molecules produce Molecules. At a reduced rate."],["Unspent energy boost Molecules production of themselfs 1 to 1."]],effect:[10,10,5,4,.2,1.01,0,0],cost:[9,12,36,300,800,5e3,15e3,36e3]},upgradesS2Info:{description:["Surface tension. Allows for bigger Puddles. (This upgrade research will break balance in late game...)","Streams. Spread quicker.","River. Spread even quicker.","Vaporization. Unlock new reset tier.","Rain. Extra production of Drops.","Storm. Boost Seas production."],effectText:[["Each Puddle boost Puddle production by ","."],["Ponds boost to Puddles production is now "," times bigger."],["Lakes get boost based on amount of Ponds. At a reduced rate."],["Gain ability to convert Drops into Clouds."],["Clouds can now produce Drops. (1 per second per "," Clouds)"],["Clouds amount boost Seas at a very reduced rate."]],effect:[1.03,1.5,0,0,1e3,0],cost:[1e3,1e8,1e20,1e10,1e12,1e25]},researchesInfo:{description:["Effect of 'Protium' upgrade is stronger.","Effect of 'Deuterium' upgrade is bigger.","Effect of 'Tritium' upgrade is better.","Discharge bonus improved.","Gain more energy from buying a building."],effectText:[["Cost scalling is "," smaller for each level."],["Each bought building boost each other by additional ","."],["Molecules now produce themselfs "," times quicker."],["Discharge is now gives extra +"," bonus per reached goal."],["A single building now gives "," times more energy."]],effect:[.01,.01,12,1,3],cost:[2e3,6500,2e4,12e3,42e3],scalling:[300,1500,1800,0,81456],max:[9,3,9,1,2]},researchesS2Info:{description:["More moles.","Production of Drops is boosted.","Surface stress."],effectText:[["Drops produce "," times more moles."],["Drops now give boost to what produces them based of bought amount, at a reduced rate."],["Surface tension upgrade is now +"," stronger. (You can decide not to buy it after 1e5 > 1e7 resource buildings for better balance...)"]],effect:[3,0,.01],cost:[20,1e9,1e5],scalling:[1.2,0,10],max:[9,1,2]},researchesAutoInfo:{description:["Buy toggles.","Automatization for buying upgrades.","Increased max offline time."],effectText:[["Unlock abbility to buy multiple buildings at same time."],["Will automatically buy "," for you."],["Research this to make max offline timer +"," hours."]],effect:[0,"Particles",1],cost:[300,3e3,1e10],scalling:[0,5e3,0],max:[1,3,1]}},Z=e=>{let s=[];for(let n=0;n<e;n++)n>=4&&n<=8?s.push(!1):s.push(!0);return s},ee=document.getElementsByClassName("toggle").length;Object.assign(a,{toggles:Z(ee)});var p=structuredClone(a),v=structuredClone(o),G=e=>{let s;return e==="p"?s=structuredClone(p):s=structuredClone(v),s},V=e=>{if(Object.prototype.hasOwnProperty.call(e,"player")&&Object.prototype.hasOwnProperty.call(e,"global")){let s=G("p");for(let i in p)Object.prototype.hasOwnProperty.call(e.player,i)||(e.player[i]=s[i]);let n=`upgrades${e.player.stage.current>1?`S${e.player.stage.current}`:""}Info`,r=`researches${e.player.stage.current>1?`S${e.player.stage.current}`:""}Info`;if(p.buildings.length>e.player.buildings.length)for(let i=e.player.buildings.length;i<p.buildings.length;i++)e.player.buildings[i]=s.buildings[i];if(o[n].cost.length>e.player.upgrades.length)for(let i=e.player.upgrades.length;i<o[n].cost.length;i++)e.player.upgrades[i]=0;if(o[r].cost.length>e.player.researches.length)for(let i=e.player.researches.length;i<o[r].cost.length;i++)e.player.researches[i]=0;if(p.researchesAuto.length>e.player.researchesAuto.length)for(let i=e.player.researchesAuto.length;i<p.researchesAuto.length;i++)e.player.researchesAuto[i]=0;if(p.toggles.length>e.player.toggles.length)for(let i=e.player.toggles.length;i<p.toggles.length;i++)e.player.toggles[i]=s.toggles[i];o.versionChanged=!1,Object.assign(a,e.player),o.intervals=e.global.intervals}else b("Save file coudn't be loaded as its missing important info.")};var t=e=>{let s=document.getElementById(e);if(s!==null)return s;throw b("Some ID failed to load, game won't be working properly. Please refresh."),new TypeError(`ID "${e}" not found.`)},J=async(e=!1)=>{if(e){let s=localStorage.getItem("save"),n=localStorage.getItem("theme");if(s!==null){let r=JSON.parse(atob(s));V(r),a.toggles[0]&&b(`Welcome back, you were away for ${d(Date.now()-a.time.updated,0,"time")}.
${o.versionChanged?`Game has been updated to v${a.version}`:`Current version is v${a.version}`}`)}else b(`Welcome to 'Fundamental'.
This is a test-project made by awWhy. Should be supported by modern browsers, phones and screen readers (need to turn support ON in settings).
Was inspired by 'Synergism', 'Antimatter Dimensions' and others.`);n!==null&&(o.theme.default=!1,o.theme.stage=Number(n))}z(!1,"toggle","reload"),D(),A(),U();for(let s=0;s<p.toggles.length;s++)Y(s,!1);E(),O(),e&&!a.toggles[0]&&await C(`Welcome back, you were away for ${d(Date.now()-a.time.updated,0,"time")}. Game was set to have offline time disabled. Press confirm to NOT to gain offline time.
${o.versionChanged?`Also game has been updated to v${a.version}`:`Current version is v${a.version}`}`)&&(a.time.updated=Date.now()),T(!1,"all")};J(!0);var{screenReader:P}=o;for(let e=0;e<p.toggles.length;e++)t(`toggle${e}`).addEventListener("click",()=>Y(e));for(let e=1;e<p.buildings.length;e++)t(`building${e}Btn`).addEventListener("click",()=>I(e));for(let e=0;e<o.upgradesInfo.cost.length;e++)t(`upgrade${e+1}`).addEventListener("mouseover",()=>k(e)),t(`upgrade${e+1}`).addEventListener("click",()=>x(e)),P&&t(`upgrade${e+1}`).addEventListener("focus",()=>x(e));for(let e=0;e<o.upgradesS2Info.cost.length;e++)t(`upgradeW${e+1}`).addEventListener("mouseover",()=>k(e)),t(`upgradeW${e+1}`).addEventListener("click",()=>x(e)),P&&t(`upgradeW${e+1}`).addEventListener("focus",()=>x(e));t("dischargeReset").addEventListener("click",async()=>await K());t("vaporizationReset").addEventListener("click",async()=>await X());t("stageReset").addEventListener("click",async()=>await _());t("buy1x").addEventListener("click",()=>E("1"));t("buyAny").addEventListener("click",()=>E("any"));t("buyAnyInput").addEventListener("blur",()=>E("any"));t("buyMax").addEventListener("click",()=>E("max"));t("buyStrict").addEventListener("click",()=>E("strict"));for(let e=0;e<o.researchesInfo.cost.length;e++)t(`research${e+1}Image`).addEventListener("mouseover",()=>k(e,"researches")),t(`research${e+1}Image`).addEventListener("click",()=>x(e,"researches")),P&&t(`research${e+1}Image`).addEventListener("focus",()=>x(e,"researches"));for(let e=0;e<o.researchesS2Info.cost.length;e++)t(`researchW${e+1}Image`).addEventListener("mouseover",()=>k(e,"researches")),t(`researchW${e+1}Image`).addEventListener("click",()=>x(e,"researches")),P&&t(`researchW${e+1}Image`).addEventListener("focus",()=>x(e,"researches"));for(let e=0;e<o.researchesAutoInfo.cost.length;e++)t(`researchAuto${e+1}Image`).addEventListener("mouseover",()=>k(e,"researchesAuto")),t(`researchAuto${e+1}Image`).addEventListener("click",()=>x(e,"researchesAuto")),P&&t(`researchAuto${e+1}Image`).addEventListener("focus",()=>x(e,"researchesAuto"));t("save").addEventListener("click",async()=>await B("save"));t("file").addEventListener("change",async()=>await B("load"));t("export").addEventListener("click",async()=>await B("export"));t("delete").addEventListener("click",async()=>await B("delete"));t("switchTheme0").addEventListener("click",()=>j(0,!0));for(let e=1;e<=o.stageInfo.word.length;e++)t(`switchTheme${e}`).addEventListener("click",()=>j(e));t("mainInterval").addEventListener("blur",()=>T(!1,"main"));t("numbersInterval").addEventListener("blur",()=>T(!1,"numbers"));t("visualInterval").addEventListener("blur",()=>T(!1,"visual"));t("autoSaveInterval").addEventListener("blur",()=>T(!1,"autoSave"));t("pauseGame").addEventListener("click",async()=>await te());t("toggle3").addEventListener("click",()=>U());t("customFontSize").addEventListener("blur",()=>U(!0));t("screenReaderToggle").addEventListener("click",()=>z(!0));if(P){for(let e=0;e<p.buildings.length;e++)t(`invisibleGetBuilding${e}`).addEventListener("click",()=>z(e,"button"));t("invisibleGetResource1").addEventListener("click",()=>z(0,"button","resource")),t("specialTabBtn").addEventListener("click",()=>A("special"))}else t("specialTabBtn").style.display="none";t("hideToggle").addEventListener("click",F);t("stageTabBtn").addEventListener("click",()=>A("stage"));t("researchTabBtn").addEventListener("click",()=>A("research"));t("settingsTabBtn").addEventListener("click",()=>A("settings"));function T(e=!1,s=""){let{intervals:n,intervalsId:r}=o;if(s!==""){let i=t("mainInterval"),c=t("numbersInterval"),u=t("visualInterval"),l=t("autoSaveInterval");if(s==="main")n.main=Math.min(Math.max(Math.trunc(Number(i.value)),20),1e3),n.main>n.numbers&&(n.numbers=n.main);else if(s==="numbers"){let g=Math.min(Math.max(Math.trunc(Number(c.value)),20),1e3);n.numbers=Math.max(g,n.main)}else s==="visual"?n.visual=Math.min(Math.max(Math.trunc(Number(u.value)*10)/10,.5),10):s==="autoSave"&&(n.autoSave=Math.min(Math.max(Math.trunc(Number(l.value)),60),1800));i.value=String(n.main),c.value=String(n.numbers),u.value=String(n.visual),l.value=String(n.autoSave)}clearInterval(r.main),clearInterval(r.numbers),clearInterval(r.visual),clearInterval(r.autoSave),e||(r.main=setInterval(W,n.main),r.numbers=setInterval(S,n.numbers),r.visual=setInterval(R,n.visual*1e3),r.autoSave=setInterval(B,n.autoSave*1e3,"save"))}async function B(e){switch(e){case"load":{let s=t("file"),n=s.files;if(n===null)return b("Loaded file wasn't found.");let r=await n[0].text();try{let i=JSON.parse(atob(r));T(!0),V(i),a.toggles[0]||await C(`This save file was set to have offline progress disabled (currently ${d(Date.now()-a.time.updated,0,"time")}). Press confirm to NOT to gain offline time.`)&&(a.time.updated=Date.now()),J()}catch(i){b("Incorrect save file format.")}finally{s.value=""}break}case"save":{let s=btoa(`{"player":${JSON.stringify(a)},"global":{"intervals":${JSON.stringify(o.intervals)}}}`);localStorage.setItem("save",s),t("isSaved").textContent="Saved",o.timeSpecial.lastSave=0;break}case"export":{await B("save");let s=localStorage.getItem("save");if(s===null)return b("Save file wasn't found. Even though game was saved just now...");let n=document.createElement("a");n.href="data:text/plain;charset=utf-8,"+s,n.download="Fundamental.txt",n.click();break}case"delete":{let s=await q(`This will truly delete your save file!
Type 'delete' to confirm.`);(s==null?void 0:s.toLowerCase())==="delete"?(T(!0),localStorage.clear(),Object.assign(a,G("p")),Object.assign(o,G("g")),a.time.started=Date.now(),a.time.updated=a.time.started,J()):s!==null&&s!==""&&b(`You wrote '${s}', so save file wasn't deleted.`);break}}}var te=async()=>{T(!0);let e=await q(`Game is currently paused. Press any button bellow to unpause it. If you want you can enter 'NoOffline' to NOT to gain offline time. (Max offline time is ${o.timeSpecial.maxOffline/3600} hours)`);(e==null?void 0:e.toLowerCase())==="nooffline"?a.time.updated=Date.now():e!==null&&e!==""&&b(`You wrote '${e}', so you gained offline time.`),T()};})();
