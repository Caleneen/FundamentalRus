"use strict";(()=>{var q=e=>{let{stage:s,buildings:r}=a;switch(e){case"discharge":a.energy.current=0;for(let n=0;n<m.buildings.length;n++)n===0?(r[0].current=3,r[0].total+=3):(r[n].current=0,r[n].true=0,v(n));break;case"stage":{a.upgrades=[],a.researches=[];let{upgrades:n,researches:c}=a;for(let d=1;d<m.buildings.length;d++)r[d].current=0,r[d].true=0,r[d].total=0;let i="upgradesInfo",u="researchesInfo";s.current!==1&&(i=`upgradesS${s.current}Info`,u=`researchesS${s.current}Info`);for(let d=0;d<o[i].cost.length;d++)n[d]=0;for(let d=0;d<o[u].cost.length;d++)c[d]=0;switch(s.current){case 1:r[0].current=3,r[0].total=3,a.energy.current=0,a.energy.total=0,a.discharge.current=0;break;case 2:r[0].current=.0028,r[0].total=.0028;break}N(),B(),P();break}}w()};var C=(e,s=!1)=>{let{stage:r,buildings:n}=a,{buildingsInfo:c,screenReader:i}=o,u=e-1;if(r.current===2&&e>2&&(u=1),!isFinite(c.cost[e])){i&&!s&&(t("invisibleBought").textContent=`Coudn't buy '${c.name[e]}', because cost is infinity`);return}if(n[u].current<c.cost[e]*(s?2:1)){i&&!s&&(t("invisibleBought").textContent=`Coudn't buy '${c.name[e]}', because didn't had enough of '${c.name[u]}'`);return}let{researchesAuto:d,buyToggle:g}=a,{stageInfo:f}=o;if(r.current===1&&(o.energyType[e]=x.energyType[e]*3**a.researches[4]),g.howMany!==1&&d[0]>0||s){let l=n[u].current;s&&(l/=2);let R=c.cost[e],V=0,H=s?-1:g.howMany;for(var p=0;l>=R&&p!==H;p++)V+=R,l-=R,R*=c.increase;if(p<H&&H!==-1&&g.strict)return;n[u].current-=V,n[e].current+=p,n[e].true+=p,n[e].total+=p,r.current===1&&(a.energy.current+=o.energyType[e]*p,a.energy.total+=o.energyType[e]*p),o.screenReader&&!s&&(t("invisibleBought").textContent=`Bought ${y(p)} '${c.name[e]}'${r.current===1?`, gained ${y(o.energyType[e]*p)} ${f.resourceName[r.current]}`:""}`)}else(g.howMany===1||d[0]===0)&&(n[u].current-=c.cost[e],n[e].current++,n[e].true++,n[e].total++,r.current===1&&(a.energy.current+=o.energyType[e],a.energy.total+=o.energyType[e]),o.screenReader&&(t("invisibleBought").textContent=`Bought 1 '${c.name[e]}'${r.current===1?`, gained ${o.energyType[e]} ${f.resourceName[r.current]}`:""}`));v(e),D(),w()},v=e=>{let{stage:s,buildings:r,upgrades:n,researches:c}=a,{buildingsInfo:i}=o;s.current===1&&(o.upgradesInfo.effect[4]=Math.trunc((.2+c[0]*.01)*100)/100,i.increase=Math.trunc((1.4-(n[4]===1?o.upgradesInfo.effect[4]:0))*100)/100),i.cost[e]=x.buildingsInfo.cost[e]*i.increase**r[e].true,s.current===1&&e===1&&n[0]===1&&(i.cost[1]/=10)},F=(e,s,r=s+"Info")=>{a[s][e]!==o[r].max[e]&&(a.stage.current===1?o[r].cost[e]=x[r].cost[e]+o[r].scalling[e]*a[s][e]:o[r].cost[e]=Math.trunc(x[r].cost[e]*o[r].scalling[e]**a[s][e]))},k=(e,s)=>{let{buildings:r}=a,{buildingsInfo:n}=o,c=r[e].current,i;if(a.stage.current===1&&e===3){if(n.producing[3]<=1)return;i=Math.log(n.producing[e])*s*12**a.researches[2],a.upgrades[7]===1&&(i*=a.energy.current)}else i=n.producing[e+1]*s;let u=r[e].current+i;if(isFinite(u))r[e].current=u;else return;u=r[e].total+(r[e].current-c),isFinite(u)&&(r[e].total=u)},b=(e,s="upgrades",r=s+"Info")=>{let{stage:n}=a,c;if(n.current===1?c=a.energy:c=a.buildings[1],s!=="upgrades"){if(a[s][e]===o[r].max[e]||c.current<o[r].cost[e])return;a[s][e]++,c.current-=o[r].cost[e];let i;if(s==="researchesAuto")i=t(`researchAuto${e+1}Level`);else{let u="";n.current===2&&(u="W"),i=t(`research${u}${e+1}Level`)}if(i.textContent=String(a[s][e]),a[s][e]!==o[r].max[e]?i.classList.replace("redText","orchidText"):(i.classList.remove("redText","orchidText"),i.classList.add("greenText")),n.current===1&&s==="researches"&&e===0)for(let u=1;u<o.buildingsInfo.name.length;u++)v(u);o.screenReader&&(t("invisibleBought").textContent=`You have researched '${o[r].description[e]}', level is now ${a[s][e]} ${a[s][e]===o[r].max[e]?"maxed":""}`),F(e,s,r)}else{if(a[s][e]===1||c.current<o[r].cost[e])return;a[s][e]=1,c.current-=o[r].cost[e];let i="";if(n.current===2&&(i="W"),t(`upgrade${i}${e+1}`).style.backgroundColor="green",n.current===1){if(e===0)v(1);else if(e===3)t("discharge").style.display="";else if(e===4)for(let u=1;u<o.buildingsInfo.name.length;u++)v(u)}o.screenReader&&(t("invisibleBought").textContent=`You have bought upgrade '${o[r].description[e]}'`)}w(),T(e,s,r)},z=(e,s=!0)=>{var c,i,u,d;let{toggles:r}=a,n=t(`toggle${e}`);s&&(r[e]=!r[e]),n.classList.contains("auto")?r[e]?(n.textContent="Auto ON",n.style.borderColor=""):(n.textContent="Auto OFF",n.style.borderColor="crimson"):r[e]?(n.textContent="ON",n.style.borderColor="",o.screenReader&&(n.ariaLabel=(d=(u=n.ariaLabel)==null?void 0:u.replace(" OFF"," ON"))!=null?d:"")):(n.textContent="OFF",n.style.borderColor="crimson",o.screenReader&&(n.ariaLabel=(i=(c=n.ariaLabel)==null?void 0:c.replace(" ON"," OFF"))!=null?i:""))},$=(e="none")=>{let{buyToggle:s}=a,r=t("buyAnyInput");switch(e){case"1":s.howMany=1;break;case"max":s.howMany=-1;break;case"any":s.input=Math.max(Math.trunc(Number(r.value)),-1),s.input===0&&(s.input=1),s.howMany=s.input;break;case"strict":s.strict=!s.strict;break;default:r.value=String(s.input)}t("buyStrict").style.borderColor=s.strict?"":"crimson",t("buy1x").style.backgroundColor=s.howMany===1?"green":"",t("buyAny").style.backgroundColor=Math.abs(s.howMany)!==1?"green":"",t("buyMax").style.backgroundColor=s.howMany===-1?"green":""},_=async()=>{let{stage:e,buildings:s,researchesAuto:r,toggles:n}=a,c=!1;if(e.current===1)if(s[3].current>=167e19){let i=!0;n[2]&&h("Stage 2 is being worked on, might come out around 20.09.2022."),i=!1,i&&(r[0]===0&&r[0]++,c=!0)}else h("There are more molecules in a single drop than that you know.");else h("Not yet in game")},K=async()=>{let{energy:e}=a,{dischargeInfo:s}=o;if(a.upgrades[3]===1&&a.buildings[1].true>0&&a.stage.current===1){let r=!0;a.toggles[1]&&e.current<s.next?r=await S("This will reset all of your current buildings and energy. You will NOT gain production boost. Continue?"):a.toggles[1]&&e.current>=s.next&&(r=await S("You have enough energy to gain boost. Continue?")),r&&(e.current>=s.next?(s.next*=10,a.discharge.current++,o.screenReader&&(t("invisibleBought").textContent="Buildings and energy were reset for some boost")):o.screenReader&&e.current<s.next&&(t("invisibleBought").textContent="Buildings and energy were reset, no boost"),q("discharge"))}};var L=(e="none")=>{if(o.tab!==e){t("stageTab").style.display="none",t("stageTabBtn").style.borderColor="",t("researchTab").style.display="none",t("researchTabBtn").style.borderColor="",t("settingsTab").style.display="none",t("settingsTabBtn").style.borderColor="";let s=["#e3e3e3","#a10000"][o.theme.stage-1],r=t("invisibleTab");t("specialTab").style.display="none",e!=="none"?o.tab=e:o.tab="stage",t(`${o.tab}Tab`).style.display="",t(`${o.tab}TabBtn`).style.borderColor=s,r.textContent=`Current tab: ${o.tab} tab`,B(),w()}},D=()=>{let{stage:e,time:s,buildings:r,upgrades:n,researches:c,researchesAuto:i,toggles:u}=a,{buildingsInfo:d}=o,g=Date.now()-s.updated,f=g/1e3;if(s.updated=Date.now(),g<0)return console.warn("Negative passed time detected.");if(o.lastSave+=g,f>3600&&(f=3600,console.log("Max offline progress is 1 hour.")),e.current===1){let{discharge:p}=a,{upgradesInfo:l}=o;u[6]&&i[1]>=3&&C(3,!0),d.producing[3]=.3*r[3].current*l.effect[3]**p.current,n[5]===1&&(d.producing[3]*=l.effect[5]**r[3].true),k(2,f),l.effect[5]=Math.trunc((1.02+.01*c[1])*100)/100,l.effect[3]=4+1*c[3],n[6]===1&&k(3,f),u[5]&&i[1]>=2&&C(2,!0),d.producing[2]=.4*r[2].current*l.effect[3]**p.current,n[2]===1&&(d.producing[2]*=5),n[5]===1&&(d.producing[2]*=l.effect[5]**r[2].true),k(1,f),u[4]&&i[1]>=1&&C(1,!0),d.producing[1]=.5*r[1].current*l.effect[3]**p.current,n[1]===1&&(d.producing[1]*=10),n[5]===1&&(d.producing[1]*=l.effect[5]**r[1].true),k(0,f)}else e.current===2&&(r[0].current<.0028&&r[1].current===0&&(r[0].current=.0028),r[1].current<r[1].true&&(r[1].true=Math.trunc(r[1].current),v(1)),d.producing[1]=4e-4*r[1].current,c[0]>0&&(d.producing[1]*=3**c[0]),k(0,f))},w=()=>{let{stage:e,buildings:s,upgrades:r}=a,{tab:n,buildingsInfo:c}=o;if(o.footer&&(e.current===1?(t("quarks").textContent=`Quarks: ${y(s[0].current)}`,a.energy.total>=9&&(t("energy").textContent=`Energy: ${y(a.energy.current,0)}`)):e.current===2&&(t("water").textContent=`Moles: ${y(s[0].current)}`,n!=="stage"&&(t("dropExtra").textContent=`Drops: ${y(s[1].current)}`))),n==="stage"){for(let i=1;i<c.name.length;i++){t(`building${i}Cur`).textContent=y(s[i].current),t(`building${i}Prod`).textContent=y(c.producing[i]);let u=i-1;e.current===2&&i>2&&(u=1),c.cost[i]<=s[u].current?(t(`building${i}Btn`).classList.add("availableBuilding"),t(`building${i}Btn`).textContent=`Buy for: ${y(c.cost[i])} ${c.name[u]}`):(t(`building${i}Btn`).classList.remove("availableBuilding"),t(`building${i}Btn`).textContent=`Need: ${y(c.cost[i])} ${c.name[u]}`)}e.current===1&&r[3]===1&&(t("dischargeReset").textContent=`Next goal is ${y(o.dischargeInfo.next,0)} Energy`,t("dischargeEffect").textContent=String(o.upgradesInfo.effect[3]))}else n==="settings"&&o.lastSave>=1e3&&(t("isSaved").textContent=`${y(o.lastSave,0,"time")} ago`)},B=()=>{let{stage:e,buildings:s,upgrades:r,researchesAuto:n}=a;if(e.current===1){let{energy:c,discharge:i}=a;t("energyStat").style.display=c.total>=9?"":"none",t("discharge").style.display=r[3]>0?"":"none",s[1].total>=11&&(t("building2").style.display=""),s[2].total>=2&&(t("building3").style.display=""),c.total>=9&&(t("upgrades").style.display=""),i.current>=1&&(t("resetToggles").style.display="");for(let u=5;u<=8;u++)t(`upgrade${u}`).style.display=i.current>=3?"":"none";i.current>=4&&(t("researchTabBtn").style.display=""),r[7]===1&&(t("stage").style.display=""),s[3].current>=167e19&&(t("stageReset").textContent="Enter next stage")}else e.current===2&&(t("dropStat").style.display=o.tab!=="stage"?"":"none",s[1].total>=400&&(t("building2").style.display=""));for(let c=1;c<m.buildings.length;c++)t(`toggle${c+3}`).style.display=n[1]>=c?"":"none";t("toggleBuy").style.display=n[0]>0?"":"none",o.screenReader&&(t("invisibleGetBuilding2").style.display=s[2].total>0?"":"none",t("invisibleGetBuilding3").style.display=s[3].total>0?"":"none",t("invisibleGetBuilding4").style.display=s[4].total>0?"":"none",t("invisibleGetBuilding5").style.display=s[5].total>0?"":"none")},T=(e,s="upgrades",r=s+"Info")=>{s.includes("researches")?(t("researchText").textContent=o[r].description[e],s==="researchesAuto"&&e===1&&(o.researchesAutoInfo.effect[1]=o.buildingsInfo.name[Math.min(a.researchesAuto[1]+1,o.buildingsInfo.name.length-1)]),o[r].effect[e]!==0?t("researchEffect").textContent=`${o[r].effectText[e][0]}${o[r].effect[e]}${o[r].effectText[e][1]}`:t("researchEffect").textContent=o[r].effectText[e][0],t("researchCost").textContent=`${a[s][e]===o[r].max[e]?0:o[r].cost[e]} ${o.stageInfo.resourceName[a.stage.current-1]}.`):(t("upgradeText").textContent=o[r].description[e],o[r].effect[e]!==0?t("upgradeEffect").textContent=`${o[r].effectText[e][0]}${o[r].effect[e]}${o[r].effectText[e][1]}`:t("upgradeEffect").textContent=o[r].effectText[e][0],t("upgradeCost").textContent=`${a[s][e]===1?0:o[r].cost[e]} ${o.stageInfo.resourceName[a.stage.current-1]}.`)},y=(e,s=e<1e3?e<1?4:2:0,r="number")=>{switch(r){case"number":if(s>0&&e<1e6)return String(Math.trunc(e*10**s)/10**s);if(s<=0&&e<1e6)return String(Math.trunc(e));{let n=Math.trunc(Math.log10(e));return`${Math.trunc(e/10**n*100)/100}e${n}`}case"time":return e>=1728e5?`${Math.trunc(e/864e5)} days`:e>=72e5?`${Math.trunc(e/36e5)} hours`:e>=6e5?`${Math.trunc(e/6e4)} minutes`:`${Math.trunc(e/1e3)} seconds`}},N=()=>{let{stage:e,upgrades:s,researches:r,researchesAuto:n}=a,{stageInfo:c,buildingsInfo:i,researchesAutoInfo:u}=o;t("upgradeCost").classList.remove("orangeText","cyanText"),t("researchCost").classList.remove("orangeText","cyanText");for(let l=2;l<m.buildings.length;l++)t(`building${l}`).style.display="none";t("upgradeText").textContent="Hover to see.",t("upgradeEffect").textContent="Hover to see.",t("upgradeCost").textContent="Resource.",t("researchText").textContent="Hover to see.",t("researchEffect").textContent="Hover to see.",t("researchCost").textContent="Resource.";let d="upgradesInfo",g="researchesInfo";e.current!==1&&(d=`upgradesS${e.current}Info`,g=`researchesS${e.current}Info`);let f="";e.current===2&&(f="W");for(let l=0;l<o[d].cost.length;l++)t(`upgrade${f}${[l+1]}`).style.backgroundColor=s[l]===1?"green":"";for(let l=0;l<o[g].cost.length;l++)t(`research${f}${l+1}Level`).textContent=String(r[l]),t(`research${f}${l+1}Level`).classList.remove("redText","orchidText","greenText"),F(l,"researches",g),r[l]===o[g].max[l]?t(`research${f}${l+1}Level`).classList.add("greenText"):r[l]===0?t(`research${f}${l+1}Level`).classList.add("redText"):t(`research${f}${l+1}Level`).classList.add("orchidText");t("quarkStat").style.display=e.current===1?"":"none",t("particles").style.display=e.current===1?"":"none",t("atoms").style.display=e.current===1?"":"none",t("molecules").style.display=e.current===1?"":"none",t("dischargeToggleReset").style.display=e.current===1?"":"none",t("waterStat").style.display=e.current===2?"":"none",t("drops").style.display=e.current===2?"":"none",t("puddles").style.display=e.current===2?"":"none",t("ponds").style.display=e.current===2?"":"none",t("lakes").style.display=e.current===2?"":"none",t("seas").style.display=e.current===2?"":"none",t("upgrades").style.display=e.true>1?"":"none",t("resetToggles").style.display=e.true>1?"":"none",t("researchTabBtn").style.display=e.true>1?"":"none",t("stage").style.display=e.true>1?"":"none",t("stageToggleReset").style.display=e.true>1?"":"none",t("themeArea").style.display=e.true>1?"":"none";for(let l=1;l<=o.researchesInfo.cost.length;l++)t(`research${l}`).style.display=e.current===1?"":"none";if(e.current===1){i.name=["Quarks","Particles","Atoms","Molecules"],x.buildingsInfo.cost=[0,3,24,3],u.cost[1]=3e3,u.scalling[1]=5e3,o.dischargeInfo.next=10**a.discharge.current,t("upgradeCost").classList.add("orangeText"),t("researchCost").classList.add("orangeText");for(let l=1;l<=4;l++)t(`upgrade${l}`).style.display=""}else if(e.current===2){i.name=["Moles","Drops","Puddles","Ponds","Lakes","Seas"],i.increase=1.2,x.buildingsInfo.cost=[0,.0028,100,9e99,9e99,9e99],t("upgradeCost").classList.add("cyanText"),t("researchCost").classList.add("cyanText");for(let l=1;l<=o.upgradesS2Info.cost.length;l++)t(`upgradeW${l}`).style.display="";for(let l=1;l<=o.researchesS2Info.cost.length;l++)t(`researchW${l}`).style.display=""}for(let l=1;l<i.name.length;l++)t(`building${l}Name`).textContent=i.name[l],v(l);u.max[1]=i.name.length-1;for(let l=0;l<u.cost.length;l++)t(`researchAuto${l+1}Level`).textContent=String(n[l]),t(`researchAuto${l+1}Level`).classList.remove("redText","orchidText","greenText"),F(l,"researchesAuto"),n[l]===u.max[l]?t(`researchAuto${l+1}Level`).classList.add("greenText"):n[l]===0?t(`researchAuto${l+1}Level`).classList.add("redText"):t(`researchAuto${l+1}Level`).classList.add("orchidText");if(t("researchAuto2Max").textContent=String(u.max[1]),e.current!==1){t("energyStat").style.display="none",t("discharge").style.display="none";for(let l=1;l<=o.upgradesInfo.cost.length;l++)t(`upgrade${l}`).style.display="none"}if(e.current!==2){t("dropStat").style.display="none";for(let l=1;l<=o.upgradesS2Info.cost.length;l++)t(`upgradeW${l}`).style.display="none";for(let l=1;l<=o.researchesS2Info.cost.length;l++)t(`researchW${l}`).style.display="none"}let p=document.body.style;if(t("stageReset").textContent="You are not ready",t("stageWord").textContent=c.word[e.current-1],e.current===1?(p.removeProperty("--border-image"),p.removeProperty("--border-stage"),p.removeProperty("--stage-text-color")):(p.setProperty("--border-image",`url(Used_art/Stage${e.current}%20border.png)`),e.current===2&&(p.setProperty("--border-stage","#1460a8"),p.setProperty("--stage-text-color","dodgerblue"))),o.screenReader){t("invisibleBought").textContent=`Current stage is '${c.word[e.current-1]}'`,t("invisibleGetResource1").style.display=e.current===1?"":"none";for(let l=0;l<i.name.length;l++)t(`invisibleGetBuilding${l}`).textContent=`Get information for ${i.name[l]}`}};var Y=(e,s=!1)=>{let{theme:r}=o;s?(r.default=!0,localStorage.removeItem("theme")):(r.default=!1,r.stage=e,localStorage.setItem("theme",String(e))),P()},P=()=>{let{stage:e}=a,{stageInfo:s,theme:r}=o,n=document.body.style;switch(n.setProperty("--transition","1s"),r.default?(r.stage=e.current,t("currentTheme").textContent="Default"):t("currentTheme").textContent=s.word[r.stage-1],n.removeProperty("--background-color"),n.removeProperty("--window-color"),n.removeProperty("--window-border"),n.removeProperty("--footer-color"),n.removeProperty("--button-main-color"),n.removeProperty("--button-main-border"),n.removeProperty("--button-main-hover"),n.removeProperty("--button-extra-hover"),n.removeProperty("--main-text-color"),n.removeProperty("--blue-text-color"),r.stage){case 2:n.setProperty("--background-color","#070026"),n.setProperty("--window-color","#000052"),n.setProperty("--window-border","blue"),n.setProperty("--footer-color","#0000db"),n.setProperty("--button-main-color","blue"),n.setProperty("--button-main-border","#427be1"),n.setProperty("--button-main-hover","#1515cf"),n.setProperty("--button-extra-hover","#2400d7"),n.setProperty("--main-text-color","dodgerblue"),n.setProperty("--blue-text-color","#82cb3b");break}setTimeout(()=>{n.removeProperty("--transition")},1e3)},h=e=>{let s=t("blocker");if(t("blocker").style.display==="block")return console.warn("Wasn't able to show another window (alert)");t("alertText").textContent=e;let r=t("confirmBtn");s.style.display="block";let n=()=>{s.style.display="none",r.removeEventListener("click",n)};r.addEventListener("click",n)},S=async e=>await new Promise(s=>{let r=t("blocker");r.style.display==="block"&&(console.warn("Wasn't able to show another window (confirm)"),s(!1)),t("alertText").textContent=e;let n=t("cancelBtn"),c=t("confirmBtn");r.style.display="block",n.style.display="block";let i=async()=>{r.style.display="none",n.style.display="none",c.removeEventListener("click",i),n.removeEventListener("click",u),s(!0)},u=async()=>{r.style.display="none",n.style.display="none",c.removeEventListener("click",i),n.removeEventListener("click",u),s(!1)};c.addEventListener("click",i),n.addEventListener("click",u)}),j=async e=>await new Promise(s=>{let r=t("blocker");r.style.display==="block"&&(console.warn("Wasn't able to show another window (prompt)"),s(null)),t("alertText").textContent=e;let n=t("inputArea"),c="",i=t("cancelBtn"),u=t("confirmBtn");r.style.display="block",i.style.display="block",n.style.display="block";let d=()=>{c=n.value},g=async()=>{r.style.display="none",i.style.display="none",n.style.display="none",n.value="",u.removeEventListener("click",g),i.removeEventListener("click",f),n.removeEventListener("blur",d),s(c)},f=async()=>{r.style.display="none",i.style.display="none",n.style.display="none",n.value="",u.removeEventListener("click",g),i.removeEventListener("click",f),n.removeEventListener("blur",d),s(null)};u.addEventListener("click",g),i.addEventListener("click",f),n.addEventListener("blur",d)}),W=()=>{let e=t("footer"),s=t("footerColor"),r=t("hideToggle"),n=t("hideText"),c=t("hideArrow");o.footer=!o.footer,r.removeEventListener("click",W),o.footer?(s.style.display="",c.style.transform="",e.style.animation="hide 1s forwards reverse",c.style.animation="rotate 1s forwards reverse",n.textContent="Hide"):(e.style.animation="hide 1s backwards",c.style.animation="rotate 1s backwards",n.textContent="Show",setTimeout(()=>{s.style.display="none",c.style.transform="rotate(180deg)"},1e3)),setTimeout(()=>{e.style.animation="",c.style.animation="",r.addEventListener("click",W)},1e3)},A=(e=!1,s="toggle",r="building")=>{var n;switch(s){case"toggle":{let c=e,i=Boolean((n=localStorage.getItem("screen reader"))!=null?n:!1),u=t("screenReaderToggle");c&&(i=!i),i?(u.textContent="ON",u.style.borderColor="crimson",u.setAttribute("aria-label","Screen reader support is ON"),localStorage.setItem("screen reader","true"),o.screenReader=!0,r==="reload"&&(a.buyToggle.strict=!1,o.intervals.main=100,o.intervals.numbers=1e3),c&&h(`For full support please refresh page. This will allow to buy upgrades on focus (because I have no idea how to make an image clickable with a keyboard), also you will get a special tab where you can check how much you own and more.
(For non screen readers this will cause issues)`)):(u.textContent="OFF",u.style.borderColor="",u.setAttribute("aria-label","Screen reader support is OFF"),localStorage.removeItem("screen reader"),o.screenReader=!1);break}case"button":{let c=e,{stage:i}=a,u=t("invisibleBought");if(r==="building"){let{buildings:d}=a,{buildingsInfo:g}=o,f=c-1;i.current===2&&c>2&&(f=1),c===0?u.textContent=`You have ${y(d[0].current)} ${g.name[0]}`:u.textContent=`You have ${y(d[c].current)} ${g.name[c]}, next one will cost ${y(g.cost[c])} ${g.name[f]}, they are producing ${y(g.producing[c])} ${g.name[f]} per second${a.researchesAuto[1]>=c?`, auto is ${a.toggles[c+3]?"on":"off"}`:""}`}else i.current===1&&(u.textContent=`You have ${a.energy.current} Energy${a.upgrades[3]===1?`, next discharge goal is ${y(o.dischargeInfo.next)} Energy`:""}`);break}}},U=(e=!1)=>{let s=document.body.style,r=t("customFontSize"),n=localStorage.getItem("fontSize");a.toggles[3]?((n===null||Number(n)<10||Number(n)>32||e)&&(n=String(Math.min(Math.max(Math.trunc(Number(r.value)*10)/10,10),32)),localStorage.setItem("fontSize",n)),s.setProperty("--font-size",`${n}px`),r.value=n):(s.setProperty("--font-size","1em"),localStorage.removeItem("fontSize"))};var a={stage:{true:1,current:1},energy:{current:0,total:0},discharge:{current:0,bonus:0},time:{updated:Date.now(),started:Date.now()},buildings:[{current:3,total:3},{current:0,true:0,total:0},{current:0,true:0,total:0},{current:0,true:0,total:0},{current:0,true:0,total:0},{current:0,true:0,total:0}],upgrades:[0,0,0,0,0,0,0,0],researches:[0,0,0,0,0],researchesAuto:[0,0],toggles:[],buyToggle:{howMany:1,input:10,strict:!0}},o={tab:"stage",footer:!0,screenReader:!1,lastSave:0,energyType:[0,1,5,20],stageInfo:{word:["Microworld","Submerged"],resourceName:["Energy","Water drops"]},theme:{stage:1,default:!0},dischargeInfo:{next:1},intervals:{main:50,numbers:50,visual:1,autoSave:180},intervalsId:{main:0,numbers:0,visual:0,autoSave:0},buildingsInfo:{name:["Quarks","Particles","Atoms","Molecules"],cost:[0,3,24,3],increase:1.4,producing:[0,0,0,0,0,0]},upgradesInfo:{description:["Bigger electrons. Particles cost decreased.","Stronger protons. Particles produce more.","More neutrons. Increased gain of Particles.","Superposition. Unlocks new reset tier.","Protium. Basic.","Deuterium. Heavy.","Tritium. Radioactive.","Nuclear fusion. More energy."],effectText:[["Particle cost is "," times cheaper."],["Particles produce "," times more Quarks."],["Atoms produce "," times more Particles."],["Abbility to reset at any time and boost production for all buildings by ",", if had enough energy."],["Cost scalling is decreased by ","."],["Buildings (only bought one's) boost themselfs by "," times."],["Molecules produce Molecules. At a reduced rate."],["Unspent energy boost Molecules production of themselfs 1 to 1."]],effect:[10,10,5,4,.2,1.01,0,0],cost:[9,12,36,300,800,5e3,15e3,36e3]},upgradesS2Info:{description:[],effectText:[],effect:[],cost:[]},researchesInfo:{description:["Effect of 'Protium' upgrade is stronger.","Effect of 'Deuterium' upgrade is bigger.","Effect of 'Tritium' upgrade is better.","Discharge bonus improved.","Gain more energy from buying a building."],effectText:[["Cost scalling is "," smaller for each level."],["Each bought building boost each other by additional ","."],["Molecules now produce themselfs "," times quicker."],["Discharge is now gives extra +"," bonus per reached goal."],["A single building now gives "," times more energy."]],effect:[.01,.01,12,1,3],cost:[2e3,6500,2e4,12e3,42e3],scalling:[300,1500,1800,0,81456],max:[9,3,9,1,2]},researchesS2Info:{description:["More moles."],effectText:[["Drops produce "," times more moles."]],effect:[3],cost:[20],scalling:[1.2],max:[9]},researchesAutoInfo:{description:["Buy toggles.","Automatization for buying upgrades."],effectText:[["Unlock abbility to buy multiple buildings at same time."],["Will automatically buy "," for you."]],effect:[0,"Particles"],cost:[300,3e3],scalling:[0,5e3],max:[1,3]}},X=e=>{let s=[];for(let r=0;r<e;r++)r>=4&&r<=8?s.push(!1):s.push(!0);return s},Z=document.getElementsByClassName("toggle").length;Object.assign(a,{toggles:X(Z)});var m=structuredClone(a),x=structuredClone(o),G=e=>{let s;return e==="p"?s=structuredClone(m):s=structuredClone(x),s},J=e=>{if(Object.prototype.hasOwnProperty.call(e,"player")&&Object.prototype.hasOwnProperty.call(e,"global")){let s=G("p");for(let r in m)Object.prototype.hasOwnProperty.call(e.player,r)||(e.player[r]=s[r]);if(e.player.stage.current===2){if(o.upgradesS2Info.cost.length>e.player.upgrades.length)for(let r=e.player.upgrades.length;r<o.upgradesS2Info.cost.length;r++)e.player.upgrades[r]=0;if(o.researchesS2Info.cost.length>e.player.researches.length)for(let r=e.player.researches.length;r<o.researchesS2Info.cost.length;r++)e.player.researches[r]=0}if(m.buildings.length>e.player.buildings.length)for(let r=e.player.buildings.length;r<m.buildings.length;r++)e.player.buildings[r]={current:0,true:0,total:0};if(m.researchesAuto.length>e.player.researchesAuto.length)for(let r=e.player.researchesAuto.length;r<m.researchesAuto.length;r++)e.player.researchesAuto[r]=0;if(m.toggles.length>e.player.toggles.length)for(let r=e.player.toggles.length;r<m.toggles.length;r++)e.player.toggles[r]=s.toggles[r];Object.assign(a,e.player),o.intervals=e.global.intervals}else h("Save file coudn't be loaded as its missing important info.")};var t=e=>{let s=document.getElementById(e);if(s!==null)return s;throw h("Some ID failed to load, game won't be working properly. Please refresh."),new TypeError(`ID "${e}" not found.`)},Q=async(e=!1)=>{if(e){let s=localStorage.getItem("save"),r=localStorage.getItem("theme");if(s!==null){let n=JSON.parse(atob(s));J(n),a.toggles[0]&&h(`Welcome back, you were away for ${y(Date.now()-a.time.updated,0,"time")}.`)}else h("Welcome. This is a test-project. Since I don't expect anyone to play this, save file can get corrupted with a new version.");r!==null&&(o.theme.default=!1,o.theme.stage=Number(r))}A(!1,"toggle","reload"),N(),L(),U();for(let s=0;s<m.toggles.length;s++)z(s,!1);$(),P(),e&&!a.toggles[0]&&await S(`Welcome back, you were away for ${y(Date.now()-a.time.updated,0,"time")}. Game was set to have offline time disabled. Press confirm to NOT to gain offline time.`)&&(a.time.updated=Date.now()),I(!1,"all")};Q(!0);var{screenReader:E}=o;for(let e=0;e<m.toggles.length;e++)t(`toggle${e}`).addEventListener("click",()=>z(e));for(let e=1;e<m.buildings.length;e++)t(`building${e}Btn`).addEventListener("click",()=>C(e));for(let e=0;e<o.upgradesInfo.cost.length;e++)t(`upgrade${e+1}`).addEventListener("mouseover",()=>T(e)),t(`upgrade${e+1}`).addEventListener("click",()=>b(e)),E&&t(`upgrade${e+1}`).addEventListener("focus",()=>b(e));for(let e=0;e<o.upgradesS2Info.cost.length;e++)t(`upgradeW${e+1}`).addEventListener("mouseover",()=>T(e,"upgrades","upgradesS2Info")),t(`upgradeW${e+1}`).addEventListener("click",()=>b(e,"upgrades","upgradesS2Info")),E&&t(`upgradeW${e+1}`).addEventListener("focus",()=>b(e,"upgrades","upgradesS2Info"));t("dischargeReset").addEventListener("click",async()=>await K());t("stageReset").addEventListener("click",async()=>await _());t("buy1x").addEventListener("click",()=>$("1"));t("buyAny").addEventListener("click",()=>$("any"));t("buyAnyInput").addEventListener("blur",()=>$("any"));t("buyMax").addEventListener("click",()=>$("max"));t("buyStrict").addEventListener("click",()=>$("strict"));for(let e=0;e<o.researchesInfo.cost.length;e++)t(`research${e+1}Image`).addEventListener("mouseover",()=>T(e,"researches")),t(`research${e+1}Image`).addEventListener("click",()=>b(e,"researches")),E&&t(`research${e+1}Image`).addEventListener("focus",()=>b(e,"researches"));for(let e=0;e<o.researchesS2Info.cost.length;e++)t(`researchW${e+1}Image`).addEventListener("mouseover",()=>T(e,"researches","researchesS2Info")),t(`researchW${e+1}Image`).addEventListener("click",()=>b(e,"researches","researchesS2Info")),E&&t(`researchW${e+1}Image`).addEventListener("focus",()=>b(e,"researches","researchesS2Info"));for(let e=0;e<o.researchesAutoInfo.cost.length;e++)t(`researchAuto${e+1}Image`).addEventListener("mouseover",()=>T(e,"researchesAuto")),t(`researchAuto${e+1}Image`).addEventListener("click",()=>b(e,"researchesAuto")),E&&t(`researchAuto${e+1}Image`).addEventListener("focus",()=>b(e,"researchesAuto"));t("save").addEventListener("click",async()=>await M("save"));t("file").addEventListener("change",async()=>await M("load"));t("export").addEventListener("click",async()=>await M("export"));t("delete").addEventListener("click",async()=>await M("delete"));t("switchTheme0").addEventListener("click",()=>Y(0,!0));for(let e=1;e<=o.stageInfo.word.length;e++)t(`switchTheme${e}`).addEventListener("click",()=>Y(e));t("mainInterval").addEventListener("blur",()=>I(!1,"main"));t("numbersInterval").addEventListener("blur",()=>I(!1,"numbers"));t("visualInterval").addEventListener("blur",()=>I(!1,"visual"));t("autoSaveInterval").addEventListener("blur",()=>I(!1,"autoSave"));t("pauseGame").addEventListener("click",async()=>await O());t("toggle3").addEventListener("click",()=>U());t("customFontSize").addEventListener("blur",()=>U(!0));t("screenReaderToggle").addEventListener("click",()=>A(!0));if(E){for(let e=0;e<m.buildings.length;e++)t(`invisibleGetBuilding${e}`).addEventListener("click",()=>A(e,"button"));t("invisibleGetResource1").addEventListener("click",()=>A(0,"button","resource")),t("specialTabBtn").addEventListener("click",()=>L("special"))}else t("specialTabBtn").style.display="none";t("hideToggle").addEventListener("click",W);t("stageTabBtn").addEventListener("click",()=>L("stage"));t("researchTabBtn").addEventListener("click",()=>L("research"));t("settingsTabBtn").addEventListener("click",()=>L("settings"));function I(e=!1,s=""){let{intervals:r,intervalsId:n}=o;if(s!==""){let c=t("mainInterval"),i=t("numbersInterval"),u=t("visualInterval"),d=t("autoSaveInterval");if(s==="main")r.main=Math.min(Math.max(Math.trunc(Number(c.value)),20),1e3),r.main>r.numbers&&(r.numbers=r.main);else if(s==="numbers"){let g=Math.min(Math.max(Math.trunc(Number(i.value)),20),1e3);r.numbers=Math.max(g,r.main)}else s==="visual"?r.visual=Math.min(Math.max(Math.trunc(Number(u.value)*10)/10,.5),10):s==="autoSave"&&(r.autoSave=Math.min(Math.max(Math.trunc(Number(d.value)),60),1800));c.value=String(r.main),i.value=String(r.numbers),u.value=String(r.visual),d.value=String(r.autoSave)}clearInterval(n.main),clearInterval(n.numbers),clearInterval(n.visual),clearInterval(n.autoSave),e||(n.main=setInterval(D,r.main),n.numbers=setInterval(w,r.numbers),n.visual=setInterval(B,r.visual*1e3),n.autoSave=setInterval(M,r.autoSave*1e3,"save"))}async function M(e){switch(e){case"load":{let s=t("file"),r=s.files;if(r===null)return h("Loaded file wasn't found.");let n=await r[0].text();try{let c=JSON.parse(atob(n));I(!0),J(c),a.toggles[0]||await S(`This save file was set to have offline progress disabled (currently ${y(Date.now()-a.time.updated,0,"time")}). Press confirm to NOT to gain offline time.`)&&(a.time.updated=Date.now()),Q()}catch(c){h("Incorrect save file format.")}finally{s.value=""}break}case"save":{let s=btoa(`{"player":${JSON.stringify(a)},"global":{"intervals":${JSON.stringify(o.intervals)}}}`);localStorage.setItem("save",s),t("isSaved").textContent="Saved",o.lastSave=0;break}case"export":{await M("save");let s=localStorage.getItem("save");if(s===null)return h("Save file wasn't found. Even though game was saved just now...");let r=document.createElement("a");r.href="data:text/plain;charset=utf-8,"+s,r.download="Fundamental.txt",r.click();break}case"delete":{let s=await j(`This will truly delete your save file!
Type 'delete' to confirm.`);(s==null?void 0:s.toLowerCase())==="delete"?(I(!0),localStorage.clear(),Object.assign(a,G("p")),Object.assign(o,G("g")),a.time.started=Date.now(),a.time.updated=a.time.started,Q()):s!==null&&s!==""&&h(`You wrote '${s}', so save file wasn't deleted.`);break}}}var O=async()=>{I(!0);let e=await j("Game is currently paused. Press any button bellow to unpause it. If you want you can enter 'NoOffline' to NOT to gain offline time. Offline timer has a limit.");(e==null?void 0:e.toLowerCase())==="nooffline"?a.time.updated=Date.now():e!==null&&e!==""&&h(`You wrote '${e}', so you gained offline time.`),I()};})();
