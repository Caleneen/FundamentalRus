"use strict";(()=>{var C=(e,s=!1)=>{let{stage:r,buildings:n}=a,{buildingsInfo:c,screenReader:i}=o;if(!isFinite(c.cost[e])){i&&!s&&(t("invisibleBought").textContent=`Coudn't buy '${c.name[e]}', because cost is infinity`);return}let l=e-1;r.current===2&&e>2&&(l=1);let g=2;if(n[e].true===0&&(g=1),n[l].current<c.cost[e]*(s?g:1)){i&&!s&&(t("invisibleBought").textContent=`Coudn't buy '${c.name[e]}', because didn't had enough of '${c.name[l]}'`);return}let{researchesAuto:u,buyToggle:d}=a;if(r.current===1&&(o.dischargeInfo.energyType[e]=$.dischargeInfo.energyType[e]*3**a.researches[4]),d.howMany!==1&&u[0]>0||s){let x=n[l].current;s&&(x/=g);let y=c.cost[e],p=0,q=s?-1:d.howMany;for(var v=0;x>=y&&v!==q;v++)p+=y,x-=y,y*=c.increase;if(v<q&&q!==-1&&d.strict)return;n[l].current-=p,n[e].current+=v,n[e].true+=v,n[e].total+=v,n[e].trueTotal+=v,r.current===1&&(a.discharge.energyCur+=o.dischargeInfo.energyType[e]*v),o.screenReader&&!s&&(t("invisibleBought").textContent=`Bought ${f(v)} '${c.name[e]}'${r.current===1?`, gained ${f(o.dischargeInfo.energyType[e]*v)} ${o.stageInfo.resourceName[r.current-1]}`:""}`)}else(d.howMany===1||u[0]===0)&&(n[l].current-=c.cost[e],n[e].current++,n[e].true++,n[e].total++,n[e].trueTotal++,r.current===1&&(a.discharge.energyCur+=o.dischargeInfo.energyType[e]),o.screenReader&&(t("invisibleBought").textContent=`Bought 1 '${c.name[e]}'${r.current===1?`, gained ${o.dischargeInfo.energyType[e]} ${o.stageInfo.resourceName[r.current-1]}`:""}`));S(e),U(),I()},S=e=>{let{stage:s,buildings:r,upgrades:n,researches:c}=a,{buildingsInfo:i}=o;s.current===1&&(o.upgradesInfo.effect[4]=Math.trunc((.2+c[0]*.01)*100)/100,i.increase=Math.trunc((1.4-(n[4]===1?o.upgradesInfo.effect[4]:0))*100)/100),i.cost[e]=$.buildingsInfo.cost[e]*i.increase**r[e].true,s.current===1&&e===1&&n[0]===1&&(i.cost[1]/=10)},N=(e,s)=>{let{stage:r}=a,n="researchesAutoInfo";s!=="researchesAuto"&&(n=`${s}${r.current>1?`S${r.current}`:""}Info`),a[s][e]!==o[n].max[e]&&(r.current===1?o[n].cost[e]=$[n].cost[e]+o[n].scalling[e]*a[s][e]:(o[n].cost[e]=Math.trunc($[n].cost[e]*o[n].scalling[e]**a[s][e]),n==="researchesAutoInfo"&&r.current===2&&e===1&&a.researchesAuto[1]>=3&&(o[n].cost[e]*=a.researchesAuto[1]>=4?1e3:100)))},L=(e,s)=>{let{stage:r,buildings:n}=a,{buildingsInfo:c}=o,i=n[e].current,l;if(r.current===1&&e===3?l=o.upgradesInfo.effect[6]*s:(l=c.producing[e+1]*s,r.current===2&&e===1&&a.researchesExtra[1]>=1&&(l+=s*10**(a.researchesExtra[1]-1))),l===0)return;let g=n[e].current+l;if(isFinite(g))n[e].current=g;else return;if(g=n[e].total+(n[e].current-i),isFinite(g))n[e].total=g;else return;g=n[e].trueTotal+(n[e].current-i),isFinite(g)&&(n[e].trueTotal=g)},M=(e,s="upgrades")=>{let{stage:r}=a,n;if(r.current===1?n=a.discharge.energyCur:n=a.buildings[1].current,s!=="upgrades"){let c="researchesAutoInfo";if(s!=="researchesAuto"&&(c=`${s}${r.current>1?`S${r.current}`:""}Info`),s==="researchesAuto"&&r.current===1&&e>1||a[s][e]===o[c].max[e]||n<o[c].cost[e])return;if(a[s][e]++,n-=o[c].cost[e],r.current===1&&s==="researches"&&e===0)for(let i=1;i<o.buildingsInfo.name.length;i++)S(i);o.screenReader&&(t("invisibleBought").textContent=`You have researched '${o[c].description[e]}', level is now ${a[s][e]} ${a[s][e]===o[c].max[e]?"maxed":""}`),N(e,s)}else{let c=`${s}${r.current>1?`S${r.current}`:""}Info`;if(a[s][e]===1||n<o[c].cost[e])return;if(a[s][e]=1,n-=o[c].cost[e],r.current===1){if(e===0)S(1);else if(e===3)t("discharge").style.display="";else if(e===4)for(let i=1;i<o.buildingsInfo.name.length;i++)S(i)}o.screenReader&&(t("invisibleBought").textContent=`You have bought upgrade '${o[c].description[e]}'`)}r.current===1?a.discharge.energyCur=n:a.buildings[1].current=n,I(),b(e,s),k(e,s)},V=(e,s=!0)=>{var c,i,l,g;let{toggles:r}=a,n=t(`toggle${e}`);s&&(r[e]=!r[e]),n.classList.contains("auto")?r[e]?(n.textContent="Auto ON",n.style.borderColor=""):(n.textContent="Auto OFF",n.style.borderColor="crimson"):r[e]?(n.textContent="ON",n.style.borderColor="",o.screenReader&&(n.ariaLabel=(g=(l=n.ariaLabel)==null?void 0:l.replace(" OFF"," ON"))!=null?g:"")):(n.textContent="OFF",n.style.borderColor="crimson",o.screenReader&&(n.ariaLabel=(i=(c=n.ariaLabel)==null?void 0:c.replace(" ON"," OFF"))!=null?i:""))},P=(e="none")=>{let{buyToggle:s}=a,r=t("buyAnyInput");switch(e){case"1":s.howMany=1;break;case"max":s.howMany=-1;break;case"any":s.input=Math.max(Math.trunc(Number(r.value)),-1),s.input===0&&(s.input=1),s.howMany=s.input;break;case"strict":s.strict=!s.strict;break;default:r.value=String(s.input)}t("buyStrict").style.borderColor=s.strict?"":"crimson",t("buy1x").style.backgroundColor=s.howMany===1?"green":"",t("buyAny").style.backgroundColor=Math.abs(s.howMany)!==1?"green":"",t("buyMax").style.backgroundColor=s.howMany===-1?"green":""},Z=async()=>{let{stage:e,buildings:s,researchesAuto:r,toggles:n}=a,c=!1,i="Ready to enter next stage? You might want to turn off all auto's first";if(e.current===1)if(s[3].current>=167e19){let l=!0;n[2]&&(l=await E(i)),l&&(r[0]===0&&r[0]++,c=!0)}else h("You will need a single Drop of water for next one");else e.current===2&&(s[1].current>=268e24?h("Not yet in game"):h("Look's like, it, can still hold more Drops"));c&&(r[1]=0,e.resets++,e.current++,e.true<e.current&&e.true++,A("stage"))},ee=async()=>{let{dischargeInfo:e}=o;if(a.upgrades[3]===1&&a.buildings[1].true>0&&a.stage.current===1){let{discharge:s}=a,r=!0;a.toggles[1]&&s.energyCur<e.next?r=await E("This will reset all of your current buildings and energy. You will NOT gain production boost. Continue?"):a.toggles[1]&&s.energyCur>=e.next&&(r=await E("You have enough energy to gain boost. Continue?")),r&&(s.energyCur>=e.next?(s.current++,e.next*=10,o.screenReader&&(t("invisibleBought").textContent="Buildings and energy were reset for some boost")):o.screenReader&&s.energyCur<e.next&&(t("invisibleBought").textContent="Buildings and energy were reset, no boost"),A("discharge"))}},te=async()=>{let{vaporizationInfo:e}=o;if(a.upgrades[1]===1&&e.get>=1&&a.stage.current===2){let{vaporization:s}=a,r=!0;a.toggles[3]&&(r=await E(`Do you wish to reset buildings and upgrades for ${f(e.get)} Clouds?`)),r&&(s.current++,s.clouds+=e.get,A("vaporization"),o.screenReader&&(t("invisibleBought").textContent=`Progress were reset for ${f(e.get)} Clouds`))}};var T=(e="none",s="tabOnly")=>{let r=["#e3e3e3","#a10000"][o.theme.stage-1];o.tab!==e&&s==="tabOnly"?(t("stageTab").style.display="none",t("stageTabBtn").style.borderColor="",t("researchTab").style.display="none",t("researchTabBtn").style.borderColor="",t("settingsTab").style.display="none",t("settingsTabBtn").style.borderColor="",t("specialTab").style.display="none",o.tab=e!=="none"?e:"stage",t(`${o.tab}Tab`).style.display="",t(`${o.tab}TabBtn`).style.borderColor=r,t("invisibleTab").textContent=`Current tab is ${o.tab} tab`,t("subtabs").style.display=Object.prototype.hasOwnProperty.call(o.subtab,e+"Current")?"":"none",t("settingsSubtabBtnsettings").style.display=o.tab==="settings"?"":"none",t("settingsSubtabBtnstats").style.display=o.tab==="settings"?"":"none",B(),I()):s!=="tabOnly"&&s!==o.subtab[e+"Current"]&&(e==="settings"&&(t("settingsSubtabsettings").style.display="none",t("settingsSubtabBtnsettings").style.borderColor="",t("settingsSubtabstats").style.display="none",t("settingsSubtabBtnstats").style.borderColor=""),o.subtab[e+"Current"]=s!=="none"?s:"settings",t(`${e}Subtab${o.subtab[e+"Current"]}`).style.display="",t(`${e}SubtabBtn${o.subtab[e+"Current"]}`).style.borderColor=r,o.screenReader&&o.tab===e&&(t("invisibleTab").textContent=`Current subtab is ${o.subtab[e+"Current"]} subtab`),B(),I())},R=()=>o.timeSpecial.maxOffline=3600+3600*a.researchesAuto[2],U=()=>{let{stage:e,time:s,buildings:r,upgrades:n,researches:c,researchesExtra:i,researchesAuto:l,toggles:g}=a,{timeSpecial:u,buildingsInfo:d}=o,v=Date.now()-s.updated,x=v/1e3;if(s.updated=Date.now(),v<0)return console.warn("Negative passed time detected.");if(u.lastSave+=v,x>R()&&(x=u.maxOffline,console.log(`Offline time was reduced to it's max of ${u.maxOffline/3600} hours.`)),e.current===1){let{discharge:y}=a,{upgradesInfo:p}=o;g[6]&&l[1]>=3&&C(3,!0),d.producing[3]=.3*r[3].current*p.effect[3]**y.current,n[5]===1&&(d.producing[3]*=p.effect[5]**r[3].true),L(2,x),p.effect[5]=Math.trunc((1.02+.01*c[1])*100)/100,p.effect[3]=4+1*c[3],p.effect[6]=0,d.producing[3]>1&&(p.effect[6]=Math.log(d.producing[3])*12**a.researches[2],n[7]===1&&(p.effect[6]*=y.energyCur)),n[6]===1&&L(3,x),g[5]&&l[1]>=2&&C(2,!0),d.producing[2]=.4*r[2].current*p.effect[3]**y.current,n[2]===1&&(d.producing[2]*=5),n[5]===1&&(d.producing[2]*=p.effect[5]**r[2].true),L(1,x),g[4]&&l[1]>=1&&C(1,!0),d.producing[1]=.5*r[1].current*p.effect[3]**y.current,n[1]===1&&(d.producing[1]*=10),n[5]===1&&(d.producing[1]*=p.effect[5]**r[1].true),L(0,x),y.energyMax<y.energyCur&&(y.energyMax=y.energyCur)}else if(e.current===2){let{vaporizationInfo:y,upgradesS2Info:p}=o;g[8]&&l[1]>=5&&C(5,!0),d.producing[5]=2*r[5].current,i[2]>=1&&(d.producing[5]*=a.vaporization.clouds**.1),g[7]&&l[1]>=4&&C(4,!0),d.producing[4]=2*r[4].current,d.producing[5]>1&&(d.producing[4]*=d.producing[5]),p.effect[5]=1+c[5],n[5]===1&&(r[3].current=r[3].true+r[4].current*p.effect[5]),g[6]&&l[1]>=3&&C(3,!0),d.producing[3]=2*r[3].current,d.producing[4]>1&&(d.producing[3]*=d.producing[4]),p.effect[4]=1+c[4],n[4]===1&&(r[2].current=r[2].true+r[3].current*p.effect[4]),g[5]&&l[1]>=2&&C(2,!0),d.producing[2]=2*r[2].current*a.vaporization.clouds,p.effect[2]=.02+c[2]*.02,p.effect[3]=.02+c[3]*.03,n[2]===1&&c[1]>=2?d.producing[2]*=r[0].total**p.effect[2]:n[2]===1&&(d.producing[2]*=r[0].current**p.effect[2]),n[3]===1&&c[1]>=1?d.producing[2]*=r[1].total**p.effect[3]:n[3]===1&&(d.producing[2]*=r[1].current**p.effect[3]),d.producing[3]>1&&(d.producing[2]*=d.producing[3]),L(1,x),r[0].current<.0028&&r[1].current===0&&(r[0].current=.0028),r[1].current<r[1].true&&(r[1].true=Math.trunc(r[1].current),S(1)),g[4]&&l[1]>=1&&C(1,!0),d.producing[1]=4e-4*r[1].current,c[0]>=1&&(d.producing[1]*=3**c[0]),n[0]===1&&(d.producing[1]*=1.1**r[1].true),L(0,x),i[0]<1?y.get=r[1].current/1e10:y.get=r[1].total/1e10,y.get>1&&(y.get=1+(y.get-1)**.6),y.get>1e4&&(y.get=1e4+(y.get-1e4)**.6)}},I=()=>{let{stage:e,buildings:s,upgrades:r}=a,{tab:n,subtab:c}=o;if(o.footer&&(e.current===1?(t("quarks").textContent=`Quarks: ${f(s[0].current)}`,a.discharge.energyMax>=9&&(t("energy").textContent=`Energy: ${f(a.discharge.energyCur,0)}`)):e.current===2&&(t("water").textContent=`Moles: ${f(s[0].current)}`,n!=="stage"&&(t("dropExtra").textContent=`Drops: ${f(s[1].current)}`),r[1]===1&&(t("clouds").textContent=`Clouds: ${f(a.vaporization.clouds)}`))),n==="stage"){let{buildingsInfo:i,lastUpgrade:l}=o;for(let g=1;g<i.name.length;g++){t(`building${g}Cur`).textContent=f(s[g].current),t(`building${g}Prod`).textContent=f(i.producing[g]);let u=g-1;e.current===2&&g>2&&(u=1),i.cost[g]<=s[u].current?(t(`building${g}Btn`).classList.add("availableBuilding"),t(`building${g}Btn`).textContent=`Buy for: ${f(i.cost[g])} ${i.name[u]}`):(t(`building${g}Btn`).classList.remove("availableBuilding"),t(`building${g}Btn`).textContent=`Need: ${f(i.cost[g])} ${i.name[u]}`)}e.current===1?r[3]===1&&(t("dischargeReset").textContent=`Next goal is ${f(o.dischargeInfo.next,0)} Energy`,t("dischargeEffect").textContent=String(o.upgradesInfo.effect[3])):e.current===2&&r[1]===1&&(t("vaporizationReset").textContent=`Reset for ${f(o.vaporizationInfo.get)} Clouds`),l[0]!==null&&l[2]&&b(l[0],l[1])}else n==="settings"&&(c.settingsCurrent==="settings"?o.timeSpecial.lastSave>=1e3&&(t("isSaved").textContent=`${f(o.timeSpecial.lastSave,0,"time")} ago`):c.settingsCurrent==="stats"&&(t("firstPlay").textContent=`${f(Date.now()-a.time.started,0,"time")} ago`,e.true>1&&(t("stageResetsCount").textContent=String(e.resets)),t("maxOfflineStat").textContent=`${o.timeSpecial.maxOffline/3600} hours`))},B=()=>{let{stage:e,buildings:s,upgrades:r,researchesAuto:n}=a,{screenReader:c}=o;if(e.current===1){let{discharge:i}=a;t("energyStat").style.display=i.energyMax>=9?"":"none",t("discharge").style.display=r[3]===1?"":"none",s[1].trueTotal>=11&&(t("building2").style.display=""),s[2].trueTotal>=2&&(t("building3").style.display=""),i.energyMax>=9&&(t("upgrades").style.display=""),i.current>=1&&(t("resetToggles").style.display="");for(let l=5;l<=8;l++)t(`upgrade${l}`).style.display=i.current>=3?"":"none";i.current>=4&&(t("researchTabBtn").style.display=""),r[7]===1&&(t("stage").style.display=""),t("stageReset").textContent=s[3].current>=167e19?"Enter next stage":"You are not ready",c&&(t("invisibleGetResource1").style.display=i.energyMax>0?"":"none")}else if(e.current===2){let{vaporization:i}=a;t("dropStat").style.display=o.tab!=="stage"?"":"none",t("cloudStat").style.display=r[1]===1?"":"none",t("vaporization").style.display=r[1]===1?"":"none",t("vaporizationToggleReset").style.display=i.current>0?"":"none",t("cloudResearch").style.display=i.current>0?"":"none",t("upgradeW3").style.display=s[2].trueTotal>=1?"":"none",t("upgradeW4").style.display=s[2].trueTotal>=1?"":"none",t("researchW3").style.display=s[2].trueTotal>=1?"":"none",t("researchW4").style.display=s[2].trueTotal>=1?"":"none",t("upgradeW2").style.display=s[3].trueTotal>=1?"":"none",t("upgradeW5").style.display=s[3].trueTotal>=1?"":"none",t("researchW5").style.display=s[3].trueTotal>=1?"":"none",t("upgradeW6").style.display=s[4].trueTotal>=1?"":"none",t("researchW6").style.display=s[4].trueTotal>=1?"":"none",t("researchClouds3").style.display=s[5].trueTotal>=1?"":"none",s[1].trueTotal>=300&&(t("building2").style.display=""),s[1].trueTotal>=5e6&&(t("building3").style.display=""),s[1].trueTotal>=5e17&&(t("building4").style.display=""),s[1].trueTotal>=5e22&&(t("building5").style.display=""),t("stageReset").textContent=s[1].current>=268e24?"Enter next stage":"You are not ready",c&&(t("invisibleGetResource1").style.display=r[1]===1?"":"none")}for(let i=1;i<m.buildings.length;i++)t(`toggle${i+3}`).style.display=n[1]>=i?"":"none";t("toggleBuy").style.display=n[0]>0?"":"none",c&&(t("invisibleGetBuilding2").style.display=s[2].trueTotal>0?"":"none",t("invisibleGetBuilding3").style.display=s[3].trueTotal>0?"":"none",t("invisibleGetBuilding4").style.display=s[4].trueTotal>0?"":"none",t("invisibleGetBuilding5").style.display=s[5].trueTotal>0?"":"none")},b=(e,s="upgrades")=>{var n,c;let{stage:r}=a;if(s!=="upgrades"){let i="researchesAutoInfo";s!=="researchesAuto"&&(i=`${s}${r.current>1?`S${r.current}`:""}Info`),s==="researchesAuto"&&e===1&&(o.researchesAutoInfo.effect[1]=o.buildingsInfo.name[Math.min(a.researchesAuto[1]+1,o.buildingsInfo.name.length-1)]),t("researchText").textContent=o[i].description[e],t("researchEffect").textContent=`${o[i].effectText[e][0]}${f((n=o[i].effect[e])!=null?n:"")}${o[i].effect[e]!==null?`${o[i].effectText[e][1]}`:""}`,t("researchCost").textContent=a[s][e]===o[i].max[e]?"Maxed.":`${f(o[i].cost[e])} ${o.stageInfo.priceName[a.stage.current-1]}.`}else{let i=`${s}${r.current>1?`S${r.current}`:""}Info`;o.lastUpgrade=[e,s,o[i].effect[e]!==null],t("upgradeText").textContent=o[i].description[e],t("upgradeEffect").textContent=`${o[i].effectText[e][0]}${f((c=o[i].effect[e])!=null?c:"")}${o[i].effect[e]!==null?`${o[i].effectText[e][1]}`:""}`,t("upgradeCost").textContent=a[s][e]===1?"Bought.":`${f(o[i].cost[e])} ${o.stageInfo.priceName[a.stage.current-1]}.`}},k=(e,s="upgrades")=>{let{stage:r}=a,n="researchesAutoInfo";s!=="researchesAuto"&&(n=`${s}${r.current>1?`S${r.current}`:""}Info`);let c="";r.current===2&&(s==="researches"||s==="upgrades"?c="W":s==="researchesExtra"&&(c="Clouds"));let i;if(s==="researchesAuto"?i=t(`researchAuto${e+1}Level`):s==="researches"||s==="researchesExtra"?i=t(`research${c}${e+1}Level`):i=t(`upgrade${c}${e+1}`),Object.prototype.hasOwnProperty.call(o[n],"max"))i.textContent=String(a[s][e]),i.classList.remove("redText","orchidText","greenText"),a[s][e]===o[n].max[e]?i.classList.add("greenText"):a[s][e]===0?i.classList.add("redText"):i.classList.add("orchidText");else{let l="green";r.current===2&&(l="darkgreen"),t(`upgrade${c}${e+1}`).style.backgroundColor=a[s][e]===1?l:""}},f=(e,s=typeof e=="number"&&e<1e3?e<1?4:2:0,r="number")=>{if(typeof e!="number")return e;switch(r){case"number":if(s>0&&e<1e6)return String(Math.trunc(e*10**s)/10**s);if(s<=0&&e<1e6)return String(Math.trunc(e));{let n=Math.trunc(Math.log10(e));return`${Math.trunc(e/10**n*100)/100}e${n}`}case"time":return e>=1728e5?`${Math.trunc(e/864e5)} days`:e>=72e5?`${Math.trunc(e/36e5)} hours`:e>=6e5?`${Math.trunc(e/6e4)} minutes`:`${Math.trunc(e/1e3)} seconds`}},G=()=>{let{stage:e}=a,{stageInfo:s,buildingsInfo:r,researchesAutoInfo:n}=o;for(let u=2;u<m.buildings.length;u++)t(`building${u}`).style.display="none";t("upgradeText").textContent="Hover to see.",t("upgradeEffect").textContent="Hover to see.",t("upgradeCost").textContent="Resource.",t("researchText").textContent="Hover to see.",t("researchEffect").textContent="Hover to see.",t("researchCost").textContent="Resource.",o.lastUpgrade[0]=null,t("quarkStat").style.display=e.current===1?"":"none",t("particles").style.display=e.current===1?"":"none",t("atoms").style.display=e.current===1?"":"none",t("molecules").style.display=e.current===1?"":"none",t("dischargeToggleReset").style.display=e.current===1?"":"none";for(let u=1;u<=o.researchesInfo.cost.length;u++)t(`research${u}`).style.display=e.current===1?"":"none";if(t("waterStat").style.display=e.current===2?"":"none",t("drops").style.display=e.current===2?"":"none",t("puddles").style.display=e.current===2?"":"none",t("ponds").style.display=e.current===2?"":"none",t("lakes").style.display=e.current===2?"":"none",t("seas").style.display=e.current===2?"":"none",t("researchAuto3").style.display=e.current>=2?"":"none",t("upgrades").style.display=e.true>1?"":"none",t("resetToggles").style.display=e.true>1?"":"none",t("researchTabBtn").style.display=e.true>1?"":"none",t("stage").style.display=e.true>1?"":"none",t("stageToggleReset").style.display=e.true>1?"":"none",t("stageResets").style.display=e.true>1?"":"none",t("themeArea").style.display=e.true>1||localStorage.getItem("theme")!==null?"":"none",t("switchTheme2").style.display=e.true>1?"":"none",e.current===1){r.name=["Quarks","Particles","Atoms","Molecules"],$.buildingsInfo.cost=[0,3,24,3],$.researchesAutoInfo.cost[1]=3e3,n.scalling[1]=5e3,o.dischargeInfo.next=10**a.discharge.current;for(let u=1;u<=4;u++)t(`upgrade${u}`).style.display=""}else if(e.current===2){r.name=["Moles","Drops","Puddles","Ponds","Lakes","Seas"],r.increase=1.2,$.buildingsInfo.cost=[0,.0028,100,1e7,1e18,1e23],$.researchesAutoInfo.cost[1]=1e10,n.scalling[1]=1e3,t("upgradeW1").style.display="";for(let u=1;u<=2;u++)t(`researchW${u}`).style.display=""}for(let u=1;u<r.name.length;u++)t(`building${u}Name`).textContent=r.name[u],S(u);let c=`upgrades${e.current>1?`S${e.current}`:""}Info`,i=`researches${e.current>1?`S${e.current}`:""}Info`,l=`researchesExtra${e.current!==1?`S${e.current}`:""}Info`;for(let u=0;u<o[c].cost.length;u++)a.upgrades[u]>1&&(a.upgrades[u]=1,console.error(`Upgrade (${u+1}) had an illegal value`)),k(u,"upgrades");for(let u=0;u<o[i].cost.length;u++)a.researches[u]>o[i].max[u]&&(a.researches[u]=o[i].max[u],console.error(`Research (${u+1}) had level above maxium`)),N(u,"researches"),k(u,"researches");if(e.current===2)for(let u=0;u<o[l].cost.length;u++)a.researchesExtra[u]>o[l].max[u]&&(a.researchesExtra[u]=o[l].max[u],console.error(`Research (${u+1}) had level above maxium`)),N(u,"researchesExtra"),k(u,"researchesExtra");n.max[1]=r.name.length-1;for(let u=0;u<n.cost.length;u++)a.researchesAuto[u]>o.researchesAutoInfo.max[u]&&(a.researchesAuto[u]=o.researchesAutoInfo.max[u],console.error(`Research (${u+1}) for automatization had level above maxium`)),N(u,"researchesAuto"),k(u,"researchesAuto");if(t("researchAuto2Max").textContent=String(n.max[1]),e.current!==1){t("energyStat").style.display="none",t("discharge").style.display="none";for(let u=1;u<=o.upgradesInfo.cost.length;u++)t(`upgrade${u}`).style.display="none"}if(e.current!==2){t("dropStat").style.display="none",t("cloudStat").style.display="none",t("vaporization").style.display="none",t("vaporizationToggleReset").style.display="none",t("cloudResearch").style.display="none";for(let u=1;u<=o.upgradesS2Info.cost.length;u++)t(`upgradeW${u}`).style.display="none";for(let u=1;u<=o.researchesS2Info.cost.length;u++)t(`researchW${u}`).style.display="none"}let g=document.body.style;if(t("stageWord").textContent=s.word[e.current-1],e.current===1?(g.removeProperty("--border-image"),g.removeProperty("--border-stage"),g.removeProperty("--stage-text-color")):(g.setProperty("--border-image",`url(Used_art/Stage${e.current}%20border.png)`),e.current===2&&(g.setProperty("--border-stage","#1460a8"),g.setProperty("--stage-text-color","dodgerblue"))),o.screenReader){t("invisibleBought").textContent=`Current stage is '${s.word[e.current-1]}'`,t("invisibleGetResource1").textContent=`Get information for ${s.resourceName[e.current-1]}`;for(let u=0;u<r.name.length;u++)t(`invisibleGetBuilding${u}`).textContent=`Get information for ${r.name[u]}`}};var J=(e,s=!1)=>{let{theme:r}=o;s?(r.default=!0,localStorage.removeItem("theme")):(r.default=!1,r.stage=e,localStorage.setItem("theme",String(e))),F()},F=()=>{let{stage:e}=a,{stageInfo:s,theme:r}=o,n=document.body.style;switch(n.setProperty("--transition","1s"),r.default?(r.stage=e.current,t("currentTheme").textContent="Default"):t("currentTheme").textContent=s.word[r.stage-1],t("upgradeCost").classList.remove("orangeText","cyanText"),t("researchCost").classList.remove("orangeText","cyanText"),n.removeProperty("--background-color"),n.removeProperty("--window-color"),n.removeProperty("--window-border"),n.removeProperty("--footer-color"),n.removeProperty("--button-main-color"),n.removeProperty("--button-main-border"),n.removeProperty("--button-main-hover"),n.removeProperty("--button-extra-hover"),n.removeProperty("--main-text-color"),n.removeProperty("--blue-text-color"),n.removeProperty("--gray-text-color"),r.stage){case 1:t("upgradeCost").classList.add("orangeText"),t("researchCost").classList.add("orangeText");break;case 2:t("upgradeCost").classList.add("cyanText"),t("researchCost").classList.add("cyanText"),n.setProperty("--background-color","#070026"),n.setProperty("--window-color","#000052"),n.setProperty("--window-border","blue"),n.setProperty("--footer-color","#0000db"),n.setProperty("--button-main-color","blue"),n.setProperty("--button-main-border","#427be1"),n.setProperty("--button-main-hover","#1515cf"),n.setProperty("--button-extra-hover","#2400d7"),n.setProperty("--main-text-color","dodgerblue"),n.setProperty("--blue-text-color","#82cb3b"),n.setProperty("--gray-text-color","#9b9b9b");break}setTimeout(()=>{n.removeProperty("--transition")},1e3)},h=e=>{let s=t("blocker");if(t("blocker").style.display==="block")return console.warn("Wasn't able to show another window (alert)");t("alertText").textContent=e;let r=t("confirmBtn");s.style.display="block";let n=()=>{s.style.display="none",r.removeEventListener("click",n)};r.addEventListener("click",n)},E=async e=>await new Promise(s=>{let r=t("blocker");if(r.style.display==="block"){console.warn("Wasn't able to show another window (confirm)"),s(!1);return}t("alertText").textContent=e;let n=t("cancelBtn"),c=t("confirmBtn");r.style.display="block",n.style.display="block";let i=async()=>{r.style.display="none",n.style.display="none",c.removeEventListener("click",i),n.removeEventListener("click",l),s(!0)},l=async()=>{r.style.display="none",n.style.display="none",c.removeEventListener("click",i),n.removeEventListener("click",l),s(!1)};c.addEventListener("click",i),n.addEventListener("click",l)}),Q=async e=>await new Promise(s=>{let r=t("blocker");if(r.style.display==="block"){console.warn("Wasn't able to show another window (prompt)"),s(null);return}t("alertText").textContent=e;let n=t("inputArea"),c="",i=t("cancelBtn"),l=t("confirmBtn");r.style.display="block",i.style.display="block",n.style.display="block";let g=()=>{c=n.value},u=async()=>{r.style.display="none",i.style.display="none",n.style.display="none",n.value="",l.removeEventListener("click",u),i.removeEventListener("click",d),n.removeEventListener("blur",g),s(c)},d=async()=>{r.style.display="none",i.style.display="none",n.style.display="none",n.value="",l.removeEventListener("click",u),i.removeEventListener("click",d),n.removeEventListener("blur",g),s(null)};l.addEventListener("click",u),i.addEventListener("click",d),n.addEventListener("blur",g)}),H=()=>{let e=t("footer"),s=t("footerColor"),r=t("hideToggle"),n=t("hideText"),c=t("hideArrow");o.footer=!o.footer,r.removeEventListener("click",H),o.footer?(s.style.display="",c.style.transform="",e.style.animation="hide 1s forwards reverse",c.style.animation="rotate 1s forwards reverse",n.textContent="Hide"):(e.style.animation="hide 1s backwards",c.style.animation="rotate 1s backwards",n.textContent="Show",setTimeout(()=>{s.style.display="none",c.style.transform="rotate(180deg)"},1e3)),setTimeout(()=>{e.style.animation="",c.style.animation="",r.addEventListener("click",H)},1e3)},X=(e=!1)=>{var n;let s=Boolean((n=localStorage.getItem("mobile device"))!=null?n:!1),r=t("mobileDeviceToggle");e&&(s=!s),s?(r.textContent="ON",r.style.borderColor="crimson",localStorage.setItem("mobile device","true"),o.mobileDevice=!0,e&&h("For full support please refresh page. This will add focus event for upgrades, to get description (more can be added if anyone using it)")):(r.textContent="OFF",r.style.borderColor="",localStorage.removeItem("mobile device"),o.mobileDevice=!1),o.screenReader&&r.setAttribute("aria-label",`Mobile device support is ${r.textContent}`)},W=(e=!1,s="toggle",r="building")=>{var n;switch(s){case"toggle":{let c=e,i=Boolean((n=localStorage.getItem("screen reader"))!=null?n:!1),l=t("screenReaderToggle");c&&(i=!i),i?(l.textContent="ON",l.style.borderColor="crimson",l.setAttribute("aria-label","Screen reader support is ON"),localStorage.setItem("screen reader","true"),o.screenReader=!0,r==="reload"&&(a.buyToggle.strict=!1,o.intervals.main=100,o.intervals.numbers=1e3),c&&h(`For full support please refresh page. You will get: focus event on upgrades to get description (I need feedback on it), special tab to check progress and more.
(For non screen readers it auto sets recommended settings on some stuff)`)):(l.textContent="OFF",l.style.borderColor="",l.setAttribute("aria-label","Screen reader support is OFF"),localStorage.removeItem("screen reader"),o.screenReader=!1);break}case"button":{let c=e,{stage:i}=a,l=t("invisibleBought");if(r==="building"){let{buildings:g}=a,{buildingsInfo:u}=o,d=c-1;i.current===2&&c>2&&(d=1),c===0?l.textContent=`You have ${f(g[0].current)} ${u.name[0]}`:l.textContent=`You have ${f(g[c].current)} ${u.name[c]}, next one will cost ${f(u.cost[c])} ${u.name[d]}, they are producing ${f(u.producing[c])} ${u.name[d]} per second${a.researchesAuto[1]>=c?`, auto is ${a.toggles[c+3]?"on":"off"}`:""}`}else i.current===1?l.textContent=`You have ${a.discharge.energyCur} Energy${a.upgrades[3]===1?`, next discharge goal is ${f(o.dischargeInfo.next)} Energy`:""}`:i.current===2&&(l.textContent=`You have ${a.vaporization.clouds} Clouds`);break}}},Y=(e=!1,s=!1)=>{var g;let r=document.body.style,n=t("customFontSize"),c=t("fontSizeToggle"),i=(g=Boolean(localStorage.getItem("enableCustomFontSize")))!=null?g:!1,l=localStorage.getItem("fontSize");e&&(i=!i),i?((l===null||Number(l)<10||Number(l)>32||s)&&(l=String(Math.min(Math.max(Math.trunc(Number(n.value)*10)/10,10),32)),localStorage.setItem("fontSize",l)),r.setProperty("--font-size",`${l}px`),n.value=l,localStorage.setItem("enableCustomFontSize","true"),c.textContent="ON",c.style.borderColor=""):(r.setProperty("--font-size","1em"),localStorage.removeItem("fontSize"),localStorage.removeItem("enableCustomFontSize"),c.textContent="OFF",c.style.borderColor="crimson")};var A=e=>{let{stage:s,buildings:r}=a;switch(e){case"discharge":a.discharge.energyCur=0,r[0].current=3;break;case"vaporization":r[0].current=.0028;for(let n=0;n<a.upgrades.length;n++)n!==1&&(a.upgrades[n]=0,k(n));break;case"stage":{a.upgrades=[],a.researches=[],a.researchesExtra=[];let{upgrades:n,researches:c,researchesExtra:i}=a;for(let d=1;d<m.buildings.length;d++)r[d].current=0,r[d].true=0,r[d].total=0,r[d].trueTotal=0;let l=`upgrades${s.current!==1?`S${s.current}`:""}Info`,g=`researches${s.current!==1?`S${s.current}`:""}Info`,u=`researchesExtra${s.current!==1?`S${s.current}`:""}Info`;for(let d=0;d<o[l].cost.length;d++)n[d]=0;for(let d=0;d<o[g].cost.length;d++)c[d]=0;if(s.current===2)for(let d=0;d<o[u].cost.length;d++)i[d]=0;switch(s.current){case 1:r[0].current=3,a.discharge.energyCur=0,a.discharge.energyMax=0,a.discharge.current=0;break;case 2:r[0].current=.0028,a.vaporization.current=0,a.vaporization.clouds=1;break}r[0].total=r[0].current,r[0].trueTotal=r[0].current,G(),B(),F();break}}if(e!=="stage"){r[0].total=r[0].current;for(let n=1;n<m.buildings.length;n++)r[n].current=0,r[n].true=0,r[n].total=0,S(n)}I()};var a={version:"v0.0.2",stage:{true:1,current:1,resets:0},discharge:{energyCur:0,energyMax:0,current:0},vaporization:{current:0,clouds:1},time:{updated:Date.now(),started:Date.now()},buildings:[{current:3,total:3,trueTotal:3},{current:0,true:0,total:0,trueTotal:0},{current:0,true:0,total:0,trueTotal:0},{current:0,true:0,total:0,trueTotal:0},{current:0,true:0,total:0,trueTotal:0},{current:0,true:0,total:0,trueTotal:0}],upgrades:[0,0,0,0,0,0,0,0],researches:[0,0,0,0,0],researchesExtra:[0,0,0],researchesAuto:[0,0,0],toggles:[],buyToggle:{howMany:1,input:10,strict:!0}},o={tab:"stage",subtab:{settingsCurrent:"settings"},footer:!0,mobileDevice:!1,screenReader:!1,versionInfo:{changed:!1,log:"Change log:"},timeSpecial:{lastSave:0,maxOffline:3600},stageInfo:{word:["Microworld","Submerged"],priceName:["Energy","Drops"],resourceName:["Energy","Clouds"]},theme:{stage:1,default:!0},dischargeInfo:{energyType:[0,1,5,20],next:1},vaporizationInfo:{get:0},intervals:{main:50,numbers:50,visual:1,autoSave:180},intervalsId:{main:0,numbers:0,visual:0,autoSave:0},buildingsInfo:{name:["Quarks","Particles","Atoms","Molecules"],cost:[0,3,24,3],increase:1.4,producing:[0,0,0,0,0,0]},upgradesInfo:{description:["Bigger electrons. Particles cost decreased.","Stronger protons. Particles produce more.","More neutrons. Increased gain of Particles.","Superposition. Unlocks new reset tier.","Protium. Basic.","Deuterium. Heavy.","Tritium. Radioactive.","Nuclear fusion. More Energy."],effectText:[["Particle cost is "," times cheaper."],["Particles produce "," times more Quarks."],["Atoms produce "," times more Particles."],["Ability to reset at any time, and if you had enough Energy, production for all buildings will be boosted by "," times."],["Cost scalling is decreased by ","."],["Buildings (only bought one's) boost themselfs by "," times."],["Molecules produce Molecules. At a reduced rate. ("," per second)"],["Unspent Energy boost Molecules production of themselfs 1 to 1."]],effect:[10,10,5,4,.2,1.01,0,null],cost:[9,12,36,300,800,5e3,15e3,36e3]},researchesInfo:{description:["Effect of 'Protium' upgrade is stronger.","Effect of 'Deuterium' upgrade is bigger.","Effect of 'Tritium' upgrade is better.","Discharge bonus improved.","Gain more Energy from buying a building."],effectText:[["Cost scalling is "," smaller for each level."],["Each bought building, boost each other by additional ","."],["Molecules now produce themselfs "," times quicker."],["Discharge is now gives extra +"," bonus per reached goal."],["A single building now gives "," times more Energy."]],effect:[.01,.01,12,1,3],cost:[2e3,6500,2e4,12e3,42e3],scalling:[300,1500,1800,0,81456],max:[9,3,9,1,2]},upgradesS2Info:{description:["A single Mole is a 6.022e23 Molecules.","Vaporization. Unlock new reset tier.","Surface tension. Allows for bigger Puddles.","Surface stress. Even bigger Puddles.","Stream. Spreads water around.","River. Spreads even more water."],effectText:[[`Drops produce Moles, based on how many Drops you have bought.
(Bought amount automatically decreases if it's less than current amount)`],["Gain ability to convert Drops into Clouds. (Puddles get boost equal to Cloud amount)"],["Puddles get boost based on Moles. (Equal to Moles ^ ",")"],["Puddles get boost based on Drops. (Equal to Drops ^ ",")"],[`Ponds do not produce Puddles, instead they give direct bonus to them.
This upgrade will give extra Puddles for every Pond you have. (`," extra Puddles per Pond)"],["Lakes now give extra Ponds. ("," extra Ponds per Lake)"]],effect:[null,null,.02,.02,1,1],cost:[1e4,1e10,1e3,1e4,2e9,5e20]},researchesS2Info:{description:["Better Mole production.","All of it, is still around.","Stronger surface tension.","Stronger surface stress.","More streams.","Distributary channel."],effectText:[["Drops produce "," times more Moles."],["Bonus to buildings is now based on total produced, rather than on hands. Level 1 for Drops, level 2 for Moles."],["Surface tension upgrade is now +"," stronger."],["Surface stress upgrade is now +"," stronger."],["With more streams, you can have even more extra Puddles. (+"," extra Puddles per Pond)"],["Rivers can split now, that allows even more Ponds per Lake. (+"," per)"]],effect:[3,null,.02,.03,1,1],cost:[20,1e12,1e5,1e6,1e14,1e22],scalling:[1.2,1e3,1e3,1e4,1e3,100],max:[9,2,3,3,2,2]},researchesExtraS2Info:{description:["Natural vaporization.","Rain Clouds.","Storm Clouds."],effectText:[["Clouds will now use total produced Drops instead, when formed. (Weaker past 1e4 Clouds)"],["Some Clouds will start pouring Drops themselfs. (1eX, x = research level - 1)"],["Seas get boost based on amount of Clouds. (Clouds ^ ",")"]],effect:[null,null,.1],cost:[1e16,1e13,1e25],scalling:[0,100,0],max:[1,4,1]},researchesAutoInfo:{description:["Buy toggles.","Automatization for buying upgrades.","Increased max offline time."],effectText:[["Unlock abbility to buy multiple buildings at same time."],["Will automatically buy "," for you."],["Research this to make max offline timer +"," hour longer."]],effect:[null,"Particles",1],cost:[300,3e3,1e9],scalling:[0,5e3,0],max:[1,3,1]},lastUpgrade:[null,"upgrades",!1]},re=e=>{let s=[];for(let r=0;r<e;r++)r>=4&&r<=8?s.push(!1):s.push(!0);return s},se=document.getElementsByClassName("toggle").length;Object.assign(a,{toggles:re(se)});var m=structuredClone(a),$=structuredClone(o),j=e=>{let s;return e==="p"?s=structuredClone(m):s=structuredClone($),s},_=e=>{if(Object.prototype.hasOwnProperty.call(e,"player")&&Object.prototype.hasOwnProperty.call(e,"global")){let s=j("p");for(let l in m)Object.prototype.hasOwnProperty.call(e.player,l)||(l==="version"?e.player[l]="0.0.0":e.player[l]=s[l]);let r=`upgrades${e.player.stage.current>1?`S${e.player.stage.current}`:""}Info`,n=`researches${e.player.stage.current>1?`S${e.player.stage.current}`:""}Info`;if(m.buildings.length>e.player.buildings.length)for(let l=e.player.buildings.length;l<m.buildings.length;l++)e.player.buildings[l]=s.buildings[l];if(o[r].cost.length>e.player.upgrades.length)for(let l=e.player.upgrades.length;l<o[r].cost.length;l++)e.player.upgrades[l]=0;if(o[n].cost.length>e.player.researches.length)for(let l=e.player.researches.length;l<o[n].cost.length;l++)e.player.researches[l]=0;if(m.researchesAuto.length>e.player.researchesAuto.length)for(let l=e.player.researchesAuto.length;l<m.researchesAuto.length;l++)e.player.researchesAuto[l]=0;if(m.toggles.length>e.player.toggles.length)for(let l=e.player.toggles.length;l<m.toggles.length;l++)e.player.toggles[l]=s.toggles[l];Object.assign(a,e.player),o.intervals=e.global.intervals;let{versionInfo:c}=o,i=a.version;c.changed=!1,c.log="Change log:",a.version==="0.0.0"&&(a.version="v0.0.1",c.log+=`
${a.version} - Stage 2 has properly came out; Your Energy has been fully reset to prevent save file corruption, sorry`,a.stage.current===2?(A("stage"),a.researchesAuto=[1,0,0]):a.stage.current===1&&(a.upgrades[3]===0?A("discharge"):a.discharge.energyCur=0),a.discharge.energyMax=0),a.version==="v0.0.1"&&(a.version="v0.0.2",c.log+=`
${a.version} - Added dynamic descriptions for upgrades, stats subtab, early Mobile device support`,a.stage.resets=a.stage.current===2?1:0),i!==a.version&&(c.changed=!0)}else h("Save file coudn't be loaded as its missing important info")};var t=e=>{let s=document.getElementById(e);if(s!==null)return s;throw h("Some ID failed to load, game won't be working properly. Please refresh"),new TypeError(`ID "${e}" not found.`)},K=async(e=!1,s="normal")=>{if(e){let r=localStorage.getItem("save"),n=localStorage.getItem("theme");if(r!==null){let c=JSON.parse(atob(r));if(_(c),a.toggles[0]){let i=Date.now()-a.time.updated;h(`Welcome back, you were away for ${f(i,0,"time")}.${i>R()*1e3?` (Max offline time is ${o.timeSpecial.maxOffline/3600} hours)`:""}${o.versionInfo.changed?`
Game has been updated to ${a.version}, ${o.versionInfo.log}`:`
Current version is ${a.version}`}`)}}else h(`Welcome to 'Fundamental'.
This is a test-project made by awWhy. Should be supported by modern browsers, phones and screen readers (need to turn support ON in settings).
Was inspired by 'Synergism', 'Antimatter Dimensions' and others.
Current version is ${a.version}`);n!==null&&(o.theme.default=!1,o.theme.stage=Number(n)),X(),W(!1,"toggle","reload"),Y()}G(),e||s==="delete"?(T(),T("settings","none"),F()):s==="normal"&&(B(),I());for(let r=0;r<m.toggles.length;r++)V(r,!1);if(P(),e&&!a.toggles[0]){let r=Date.now()-a.time.updated;await E(`Welcome back, you were away for ${f(r,0,"time")}${r>R()*1e3?` (max offline time is ${o.timeSpecial.maxOffline/3600} hours)`:""}. Game was set to have offline time disabled. Press confirm to NOT to gain offline time.${o.versionInfo.changed?`
Also game has been updated to ${a.version}, ${o.versionInfo.log}`:`
Current version is ${a.version}`}`)&&(a.time.updated=Date.now())}w(!1,"all")};K(!0);var{mobileDevice:D,screenReader:O}=o;for(let e=0;e<m.toggles.length;e++)t(`toggle${e}`).addEventListener("click",()=>V(e));for(let e=1;e<m.buildings.length;e++)t(`building${e}Btn`).addEventListener("click",()=>C(e));for(let e=0;e<o.upgradesInfo.cost.length;e++)t(`upgrade${e+1}`).addEventListener("mouseover",()=>b(e)),t(`upgrade${e+1}`).addEventListener("click",()=>M(e)),(O||D)&&t(`upgrade${e+1}`).addEventListener("focus",()=>b(e));for(let e=0;e<o.upgradesS2Info.cost.length;e++)t(`upgradeW${e+1}`).addEventListener("mouseover",()=>b(e)),t(`upgradeW${e+1}`).addEventListener("click",()=>M(e)),(O||D)&&t(`upgradeW${e+1}`).addEventListener("focus",()=>b(e));t("dischargeReset").addEventListener("click",async()=>await ee());t("vaporizationReset").addEventListener("click",async()=>await te());t("stageReset").addEventListener("click",async()=>await Z());t("buy1x").addEventListener("click",()=>P("1"));t("buyAny").addEventListener("click",()=>P("any"));t("buyAnyInput").addEventListener("blur",()=>P("any"));t("buyMax").addEventListener("click",()=>P("max"));t("buyStrict").addEventListener("click",()=>P("strict"));for(let e=0;e<o.researchesInfo.cost.length;e++)t(`research${e+1}Image`).addEventListener("mouseover",()=>b(e,"researches")),t(`research${e+1}Image`).addEventListener("click",()=>M(e,"researches")),(O||D)&&t(`research${e+1}Image`).addEventListener("focus",()=>b(e,"researches"));for(let e=0;e<o.researchesS2Info.cost.length;e++)t(`researchW${e+1}Image`).addEventListener("mouseover",()=>b(e,"researches")),t(`researchW${e+1}Image`).addEventListener("click",()=>M(e,"researches")),(O||D)&&t(`researchW${e+1}Image`).addEventListener("focus",()=>b(e,"researches"));for(let e=0;e<o.researchesExtraS2Info.cost.length;e++)t(`researchClouds${e+1}Image`).addEventListener("mouseover",()=>b(e,"researchesExtra")),t(`researchClouds${e+1}Image`).addEventListener("click",()=>M(e,"researchesExtra")),(O||D)&&t(`researchClouds${e+1}Image`).addEventListener("focus",()=>b(e,"researchesExtra"));for(let e=0;e<o.researchesAutoInfo.cost.length;e++)t(`researchAuto${e+1}Image`).addEventListener("mouseover",()=>b(e,"researchesAuto")),t(`researchAuto${e+1}Image`).addEventListener("click",()=>M(e,"researchesAuto")),(O||D)&&t(`researchAuto${e+1}Image`).addEventListener("focus",()=>b(e,"researchesAuto"));t("save").addEventListener("click",async()=>await z("save"));t("file").addEventListener("change",async()=>await z("load"));t("export").addEventListener("click",async()=>await z("export"));t("delete").addEventListener("click",async()=>await z("delete"));t("switchTheme0").addEventListener("click",()=>J(0,!0));for(let e=1;e<=o.stageInfo.word.length;e++)t(`switchTheme${e}`).addEventListener("click",()=>J(e));t("mainInterval").addEventListener("blur",()=>w(!1,"main"));t("numbersInterval").addEventListener("blur",()=>w(!1,"numbers"));t("visualInterval").addEventListener("blur",()=>w(!1,"visual"));t("autoSaveInterval").addEventListener("blur",()=>w(!1,"autoSave"));t("pauseGame").addEventListener("click",async()=>await ne());t("fontSizeToggle").addEventListener("click",()=>Y(!0));t("customFontSize").addEventListener("blur",()=>Y(!1,!0));t("mobileDeviceToggle").addEventListener("click",()=>X(!0));t("screenReaderToggle").addEventListener("click",()=>W(!0));if(O){for(let e=0;e<m.buildings.length;e++)t(`invisibleGetBuilding${e}`).addEventListener("click",()=>W(e,"button"));t("invisibleGetResource1").addEventListener("click",()=>W(0,"button","resource")),t("specialTabBtn").addEventListener("click",()=>T("special"))}else t("specialTabBtn").style.display="none";t("hideToggle").addEventListener("click",H);t("stageTabBtn").addEventListener("click",()=>T("stage"));t("researchTabBtn").addEventListener("click",()=>T("research"));t("settingsTabBtn").addEventListener("click",()=>T("settings"));t("settingsSubtabBtnsettings").addEventListener("click",()=>T("settings","settings"));t("settingsSubtabBtnstats").addEventListener("click",()=>T("settings","stats"));function w(e=!1,s=""){let{intervals:r,intervalsId:n}=o;if(s!==""){let c=t("mainInterval"),i=t("numbersInterval"),l=t("visualInterval"),g=t("autoSaveInterval");if(s==="main")r.main=Math.min(Math.max(Math.trunc(Number(c.value)),20),1e3),r.main>r.numbers&&(r.numbers=r.main);else if(s==="numbers"){let u=Math.min(Math.max(Math.trunc(Number(i.value)),20),1e3);r.numbers=Math.max(u,r.main)}else s==="visual"?r.visual=Math.min(Math.max(Math.trunc(Number(l.value)*10)/10,.5),10):s==="autoSave"&&(r.autoSave=Math.min(Math.max(Math.trunc(Number(g.value)),60),1800));c.value=String(r.main),i.value=String(r.numbers),l.value=String(r.visual),g.value=String(r.autoSave)}clearInterval(n.main),clearInterval(n.numbers),clearInterval(n.visual),clearInterval(n.autoSave),e||(n.main=setInterval(U,r.main),n.numbers=setInterval(I,r.numbers),n.visual=setInterval(B,r.visual*1e3),n.autoSave=setInterval(z,r.autoSave*1e3,"save"))}async function z(e){switch(e){case"load":{let s=t("file"),r=s.files;if(r===null)return h("Loaded file wasn't found, somehow");let n=await r[0].text();try{let c=JSON.parse(atob(n)),i=c.player.version;w(!0),_(c);let l=Date.now()-a.time.updated;a.toggles[0]?h(`This save is ${f(l,0,"time")} old${l>R()*1e3?`, max offline time is ${o.timeSpecial.maxOffline/3600} hours`:""}.${i!==a.version?`
Also save file version is ${i}, while game version is ${a.version}, ${o.versionInfo.log}.`:`
Save file version is ${a.version}`}`):await E(`This save file was set to have offline progress disabled (currently ${f(l,0,"time")}${l>R()*1e3?`, max is ${o.timeSpecial.maxOffline/3600} hours`:""}). Press confirm to NOT to gain offline time.${i!==a.version?`
Also save file version is ${i}, while game version is ${a.version}, ${o.versionInfo.log}`:`
Save file version is ${a.version}`}`)&&(a.time.updated=Date.now()),K()}catch(c){h("Incorrect save file format")}finally{s.value=""}break}case"save":{let s=btoa(`{"player":${JSON.stringify(a)},"global":{"intervals":${JSON.stringify(o.intervals)}}}`);localStorage.setItem("save",s),t("isSaved").textContent="Saved",o.timeSpecial.lastSave=0;break}case"export":{await z("save");let s=localStorage.getItem("save");if(s===null)return h("Save file wasn't found. Even though game was saved just now...");let r=document.createElement("a");r.href="data:text/plain;charset=utf-8,"+s,r.download="Fundamental.txt",r.click();break}case"delete":{let s=await Q(`This will truly delete your save file!
Type 'delete' to confirm.`);(s==null?void 0:s.toLowerCase())==="delete"?(w(!0),localStorage.clear(),Object.assign(a,j("p")),Object.assign(o,j("g")),a.time.started=Date.now(),a.time.updated=a.time.started,K(!1,"delete")):s!==null&&s!==""&&h(`You wrote '${s}', so save file wasn't deleted`);break}}}var ne=async()=>{w(!0);let e=await Q(`Game is currently paused. Press any button bellow to unpause it. If you want you can enter 'NoOffline' to NOT to gain offline time. (Max offline time is ${o.timeSpecial.maxOffline/3600} hours)`);(e==null?void 0:e.toLowerCase())==="nooffline"?a.time.updated=Date.now():e!==null&&e!==""&&h(`You wrote '${e}', so you gained offline time`),w()};})();
