"use strict";(()=>{var Q=e=>{let{stage:s,buildings:n}=l;switch(e){case"discharge":l.energy.current=0,n[0].current=3;break;case"vaporization":n[0].current=.0028;for(let r=0;r<o.upgradesS2Info.cost.length;r++)l.upgrades[r]=0,x(r);for(let r=0;r<o.researchesS2Info.cost.length;r++)l.researches[r]=0,x(r,"researches");break;case"stage":{l.upgrades=[],l.researches=[];let{upgrades:r,researches:a}=l;for(let i=1;i<p.buildings.length;i++)n[i].current=0,n[i].true=0,n[i].total=0;let c="upgradesInfo",u="researchesInfo";s.current!==1&&(c=`upgradesS${s.current}Info`,u=`researchesS${s.current}Info`);for(let i=0;i<o[c].cost.length;i++)r[i]=0;for(let i=0;i<o[u].cost.length;i++)a[i]=0;switch(s.current){case 1:n[0].current=3,n[0].total=3,l.energy.current=0,l.energy.total=0,l.discharge.current=0;break;case 2:n[0].current=.0028,n[0].total=.0028;break}N(),A(),B();break}}if(e!=="stage")for(let r=1;r<p.buildings.length;r++)n[r].current=0,n[r].true=0,I(r);$()};var L=(e,s=!1)=>{let{stage:n,buildings:r}=l,{buildingsInfo:a,screenReader:c}=o,u=e-1;if(n.current===2&&e>2&&(u=1),!isFinite(a.cost[e])){c&&!s&&(t("invisibleBought").textContent=`Coudn't buy '${a.name[e]}', because cost is infinity`);return}if(r[u].current<a.cost[e]*(s?2:1)){c&&!s&&(t("invisibleBought").textContent=`Coudn't buy '${a.name[e]}', because didn't had enough of '${a.name[u]}'`);return}let{researchesAuto:i,buyToggle:d}=l,{stageInfo:f}=o;if(n.current===1&&(o.energyType[e]=b.energyType[e]*3**l.researches[4]),d.howMany!==1&&i[0]>0||s){let h=r[u].current;s&&(h/=2);let O=a.cost[e],J=0,G=s?-1:d.howMany;for(var y=0;h>=O&&y!==G;y++)J+=O,h-=O,O*=a.increase;if(y<G&&G!==-1&&d.strict)return;r[u].current-=J,r[e].current+=y,r[e].true+=y,r[e].total+=y,n.current===1&&(l.energy.current+=o.energyType[e]*y,l.energy.total+=o.energyType[e]*y),o.screenReader&&!s&&(t("invisibleBought").textContent=`Bought ${g(y)} '${a.name[e]}'${n.current===1?`, gained ${g(o.energyType[e]*y)} ${f.resourceName[n.current]}`:""}`)}else(d.howMany===1||i[0]===0)&&(r[u].current-=a.cost[e],r[e].current++,r[e].true++,r[e].total++,n.current===1&&(l.energy.current+=o.energyType[e],l.energy.total+=o.energyType[e]),o.screenReader&&(t("invisibleBought").textContent=`Bought 1 '${a.name[e]}'${n.current===1?`, gained ${o.energyType[e]} ${f.resourceName[n.current]}`:""}`));I(e),U(),$()},I=e=>{let{stage:s,buildings:n,upgrades:r,researches:a}=l,{buildingsInfo:c}=o;s.current===1&&(o.upgradesInfo.effect[4]=Math.trunc((.2+a[0]*.01)*100)/100,c.increase=Math.trunc((1.4-(r[4]===1?o.upgradesInfo.effect[4]:0))*100)/100),c.cost[e]=b.buildingsInfo.cost[e]*c.increase**n[e].true,s.current===1&&e===1&&r[0]===1&&(c.cost[1]/=10)},D=(e,s)=>{let{stage:n}=l,r="researchesAutoInfo";s!=="researchesAuto"&&(r=`${s}${n.current>1?`S${n.current}`:""}Info`),l[s][e]!==o[r].max[e]&&(n.current===1?o[r].cost[e]=b[r].cost[e]+o[r].scalling[e]*l[s][e]:o[r].cost[e]=Math.trunc(b[r].cost[e]*o[r].scalling[e]**l[s][e]))},T=(e,s)=>{let{buildings:n}=l,{buildingsInfo:r}=o,a=n[e].current,c;if(l.stage.current===1&&e===3){if(r.producing[3]<=1)return;c=Math.log(r.producing[e])*s*12**l.researches[2],l.upgrades[7]===1&&(c*=l.energy.current)}else c=r.producing[e+1]*s;let u=n[e].current+c;if(isFinite(u))n[e].current=u;else return;u=n[e].total+(n[e].current-a),isFinite(u)&&(n[e].total=u)},v=(e,s="upgrades")=>{let{stage:n}=l,r;if(n.current===1?r=l.energy:r=l.buildings[1],s!=="upgrades"){let a="researchesAutoInfo";if(s!=="researchesAuto"&&(a=`${s}${n.current>1?`S${n.current}`:""}Info`),l[s][e]===o[a].max[e]||r.current<o[a].cost[e])return;if(l[s][e]++,r.current-=o[a].cost[e],n.current===1&&s==="researches"&&e===0)for(let c=1;c<o.buildingsInfo.name.length;c++)I(c);o.screenReader&&(t("invisibleBought").textContent=`You have researched '${o[a].description[e]}', level is now ${l[s][e]} ${l[s][e]===o[a].max[e]?"maxed":""}`),D(e,s)}else{let a=`${s}${n.current>1?`S${n.current}`:""}Info`;if(l[s][e]===1||r.current<o[a].cost[e])return;if(l[s][e]=1,r.current-=o[a].cost[e],n.current===1){if(e===0)I(1);else if(e===3)t("discharge").style.display="";else if(e===4)for(let c=1;c<o.buildingsInfo.name.length;c++)I(c)}o.screenReader&&(t("invisibleBought").textContent=`You have bought upgrade '${o[a].description[e]}'`)}$(),S(e,s),x(e,s)},H=(e,s=!0)=>{var a,c,u,i;let{toggles:n}=l,r=t(`toggle${e}`);s&&(n[e]=!n[e]),r.classList.contains("auto")?n[e]?(r.textContent="Auto ON",r.style.borderColor=""):(r.textContent="Auto OFF",r.style.borderColor="crimson"):n[e]?(r.textContent="ON",r.style.borderColor="",o.screenReader&&(r.ariaLabel=(i=(u=r.ariaLabel)==null?void 0:u.replace(" OFF"," ON"))!=null?i:"")):(r.textContent="OFF",r.style.borderColor="crimson",o.screenReader&&(r.ariaLabel=(c=(a=r.ariaLabel)==null?void 0:a.replace(" ON"," OFF"))!=null?c:""))},k=(e="none")=>{let{buyToggle:s}=l,n=t("buyAnyInput");switch(e){case"1":s.howMany=1;break;case"max":s.howMany=-1;break;case"any":s.input=Math.max(Math.trunc(Number(n.value)),-1),s.input===0&&(s.input=1),s.howMany=s.input;break;case"strict":s.strict=!s.strict;break;default:n.value=String(s.input)}t("buyStrict").style.borderColor=s.strict?"":"crimson",t("buy1x").style.backgroundColor=s.howMany===1?"green":"",t("buyAny").style.backgroundColor=Math.abs(s.howMany)!==1?"green":"",t("buyMax").style.backgroundColor=s.howMany===-1?"green":""},_=async()=>{let{stage:e,buildings:s,researchesAuto:n,toggles:r}=l,a=!1;if(e.current===1)if(s[3].current>=167e19){let c=!0;r[2]&&m("Stage 2 is being worked on, might come out around 20.09.2022."),c=!1,c&&(n[0]===0&&n[0]++,a=!0)}else m("There are more molecules in a single drop than that you know.");else m("Not yet in game")},K=async()=>{let{energy:e}=l,{dischargeInfo:s}=o;if(l.upgrades[3]===1&&l.buildings[1].true>0&&l.stage.current===1){let n=!0;l.toggles[1]&&e.current<s.next?n=await C("This will reset all of your current buildings and energy. You will NOT gain production boost. Continue?"):l.toggles[1]&&e.current>=s.next&&(n=await C("You have enough energy to gain boost. Continue?")),n&&(e.current>=s.next?(s.next*=10,l.discharge.current++,o.screenReader&&(t("invisibleBought").textContent="Buildings and energy were reset for some boost")):o.screenReader&&e.current<s.next&&(t("invisibleBought").textContent="Buildings and energy were reset, no boost"),Q("discharge"))}};var E=(e="none")=>{if(o.tab!==e){t("stageTab").style.display="none",t("stageTabBtn").style.borderColor="",t("researchTab").style.display="none",t("researchTabBtn").style.borderColor="",t("settingsTab").style.display="none",t("settingsTabBtn").style.borderColor="";let s=["#e3e3e3","#a10000"][o.theme.stage-1],n=t("invisibleTab");t("specialTab").style.display="none",e!=="none"?o.tab=e:o.tab="stage",t(`${o.tab}Tab`).style.display="",t(`${o.tab}TabBtn`).style.borderColor=s,n.textContent=`Current tab: ${o.tab} tab`,A(),$()}},U=()=>{let{stage:e,time:s,buildings:n,upgrades:r,researches:a,researchesAuto:c,toggles:u}=l,{buildingsInfo:i}=o,d=Date.now()-s.updated,f=d/1e3;if(s.updated=Date.now(),d<0)return console.warn("Negative passed time detected.");if(o.lastSave+=d,f>3600&&(f=3600,console.log("Max offline progress is 1 hour.")),e.current===1){let{discharge:y}=l,{upgradesInfo:h}=o;u[6]&&c[1]>=3&&L(3,!0),i.producing[3]=.3*n[3].current*h.effect[3]**y.current,r[5]===1&&(i.producing[3]*=h.effect[5]**n[3].true),T(2,f),h.effect[5]=Math.trunc((1.02+.01*a[1])*100)/100,h.effect[3]=4+1*a[3],r[6]===1&&T(3,f),u[5]&&c[1]>=2&&L(2,!0),i.producing[2]=.4*n[2].current*h.effect[3]**y.current,r[2]===1&&(i.producing[2]*=5),r[5]===1&&(i.producing[2]*=h.effect[5]**n[2].true),T(1,f),u[4]&&c[1]>=1&&L(1,!0),i.producing[1]=.5*n[1].current*h.effect[3]**y.current,r[1]===1&&(i.producing[1]*=10),r[5]===1&&(i.producing[1]*=h.effect[5]**n[1].true),T(0,f)}else if(e.current===2){let{upgradesS2Info:y}=o;i.producing[3]=2*n[3].current,r[1]===1&&(i.producing[3]*=1.5),i.producing[2]=2*n[2].current,y.effect[0]=1.03+a[2]*.01,r[0]===1&&(i.producing[2]*=y.effect[0]**n[2].true),n[3].current>=1&&(i.producing[2]*=i.producing[3]),a[1]>=1&&n[1].true>1&&(i.producing[2]*=Math.log10(n[1].true)),T(1,f),n[0].current<.0028&&n[1].current===0&&(n[0].current=.0028),n[1].current<n[1].true&&(n[1].true=Math.trunc(n[1].current),I(1)),i.producing[1]=4e-4*n[1].current,a[0]>0&&(i.producing[1]*=3**a[0]),T(0,f)}},$=()=>{let{stage:e,buildings:s,upgrades:n}=l,{tab:r,buildingsInfo:a}=o;if(o.footer&&(e.current===1?(t("quarks").textContent=`Quarks: ${g(s[0].current)}`,l.energy.total>=9&&(t("energy").textContent=`Energy: ${g(l.energy.current,0)}`)):e.current===2&&(t("water").textContent=`Moles: ${g(s[0].current)}`,r!=="stage"&&(t("dropExtra").textContent=`Drops: ${g(s[1].current)}`))),r==="stage"){for(let c=1;c<a.name.length;c++){t(`building${c}Cur`).textContent=g(s[c].current),t(`building${c}Prod`).textContent=g(a.producing[c]);let u=c-1;e.current===2&&c>2&&(u=1),a.cost[c]<=s[u].current?(t(`building${c}Btn`).classList.add("availableBuilding"),t(`building${c}Btn`).textContent=`Buy for: ${g(a.cost[c])} ${a.name[u]}`):(t(`building${c}Btn`).classList.remove("availableBuilding"),t(`building${c}Btn`).textContent=`Need: ${g(a.cost[c])} ${a.name[u]}`)}e.current===1&&n[3]===1&&(t("dischargeReset").textContent=`Next goal is ${g(o.dischargeInfo.next,0)} Energy`,t("dischargeEffect").textContent=String(o.upgradesInfo.effect[3]))}else r==="settings"&&o.lastSave>=1e3&&(t("isSaved").textContent=`${g(o.lastSave,0,"time")} ago`)},A=()=>{let{stage:e,buildings:s,upgrades:n,researchesAuto:r}=l;if(e.current===1){let{energy:a,discharge:c}=l;t("energyStat").style.display=a.total>=9?"":"none",t("discharge").style.display=n[3]>0?"":"none",s[1].total>=11&&(t("building2").style.display=""),s[2].total>=2&&(t("building3").style.display=""),a.total>=9&&(t("upgrades").style.display=""),c.current>=1&&(t("resetToggles").style.display="");for(let u=5;u<=8;u++)t(`upgrade${u}`).style.display=c.current>=3?"":"none";c.current>=4&&(t("researchTabBtn").style.display=""),n[7]===1&&(t("stage").style.display=""),s[3].current>=167e19&&(t("stageReset").textContent="Enter next stage")}else e.current===2&&(t("dropStat").style.display=o.tab!=="stage"?"":"none",s[1].total>=400&&(t("building2").style.display=""),s[1].total>=1e7&&(t("building3").style.display=""));for(let a=1;a<p.buildings.length;a++)t(`toggle${a+3}`).style.display=r[1]>=a?"":"none";t("toggleBuy").style.display=r[0]>0?"":"none",o.screenReader&&(t("invisibleGetBuilding2").style.display=s[2].total>0?"":"none",t("invisibleGetBuilding3").style.display=s[3].total>0?"":"none",t("invisibleGetBuilding4").style.display=s[4].total>0?"":"none",t("invisibleGetBuilding5").style.display=s[5].total>0?"":"none")},S=(e,s="upgrades")=>{let{stage:n}=l;if(s!=="upgrades"){let r="researchesAutoInfo";s!=="researchesAuto"&&(r=`${s}${n.current>1?`S${n.current}`:""}Info`),t("researchText").textContent=o[r].description[e],s==="researchesAuto"&&e===1&&(o.researchesAutoInfo.effect[1]=o.buildingsInfo.name[Math.min(l.researchesAuto[1]+1,o.buildingsInfo.name.length-1)]),o[r].effect[e]!==0?t("researchEffect").textContent=`${o[r].effectText[e][0]}${o[r].effect[e]}${o[r].effectText[e][1]}`:t("researchEffect").textContent=o[r].effectText[e][0],t("researchCost").textContent=`${l[s][e]===o[r].max[e]?0:g(o[r].cost[e])} ${o.stageInfo.resourceName[l.stage.current-1]}.`}else{let r=`${s}${n.current>1?`S${n.current}`:""}Info`;t("upgradeText").textContent=o[r].description[e],o[r].effect[e]!==0?t("upgradeEffect").textContent=`${o[r].effectText[e][0]}${o[r].effect[e]}${o[r].effectText[e][1]}`:t("upgradeEffect").textContent=o[r].effectText[e][0],t("upgradeCost").textContent=`${l[s][e]===1?0:g(o[r].cost[e])} ${o.stageInfo.resourceName[l.stage.current-1]}.`}},x=(e,s="upgrades")=>{let{stage:n}=l,r="researchesAutoInfo";s!=="researchesAuto"&&(r=`${s}${n.current>1?`S${n.current}`:""}Info`);let a="";n.current===2&&(a="W");let c;if(s==="researchesAuto"?c=t(`researchAuto${e+1}Level`):s==="researches"?c=t(`research${a}${e+1}Level`):c=t(`upgrade${a}${e+1}`),Object.prototype.hasOwnProperty.call(o[r],"max"))c.textContent=String(l[s][e]),c.classList.remove("redText","orchidText","greenText"),l[s][e]===o[r].max[e]?c.classList.add("greenText"):l[s][e]===0?c.classList.add("redText"):c.classList.add("orchidText");else{let u="green";n.current===2&&(u="darkgreen"),t(`upgrade${a}${e+1}`).style.backgroundColor=l[s][e]===1?u:""}},g=(e,s=e<1e3?e<1?4:2:0,n="number")=>{switch(n){case"number":if(s>0&&e<1e6)return String(Math.trunc(e*10**s)/10**s);if(s<=0&&e<1e6)return String(Math.trunc(e));{let r=Math.trunc(Math.log10(e));return`${Math.trunc(e/10**r*100)/100}e${r}`}case"time":return e>=1728e5?`${Math.trunc(e/864e5)} days`:e>=72e5?`${Math.trunc(e/36e5)} hours`:e>=6e5?`${Math.trunc(e/6e4)} minutes`:`${Math.trunc(e/1e3)} seconds`}},N=()=>{let{stage:e}=l,{stageInfo:s,buildingsInfo:n,researchesAutoInfo:r}=o;t("upgradeCost").classList.remove("orangeText","cyanText"),t("researchCost").classList.remove("orangeText","cyanText");for(let i=2;i<p.buildings.length;i++)t(`building${i}`).style.display="none";t("upgradeText").textContent="Hover to see.",t("upgradeEffect").textContent="Hover to see.",t("upgradeCost").textContent="Resource.",t("researchText").textContent="Hover to see.",t("researchEffect").textContent="Hover to see.",t("researchCost").textContent="Resource.",t("quarkStat").style.display=e.current===1?"":"none",t("particles").style.display=e.current===1?"":"none",t("atoms").style.display=e.current===1?"":"none",t("molecules").style.display=e.current===1?"":"none",t("dischargeToggleReset").style.display=e.current===1?"":"none",t("waterStat").style.display=e.current===2?"":"none",t("drops").style.display=e.current===2?"":"none",t("puddles").style.display=e.current===2?"":"none",t("ponds").style.display=e.current===2?"":"none",t("lakes").style.display=e.current===2?"":"none",t("seas").style.display=e.current===2?"":"none",t("upgrades").style.display=e.true>1?"":"none",t("resetToggles").style.display=e.true>1?"":"none",t("researchTabBtn").style.display=e.true>1?"":"none",t("stage").style.display=e.true>1?"":"none",t("stageToggleReset").style.display=e.true>1?"":"none",t("themeArea").style.display=e.true>1?"":"none";for(let i=1;i<=o.researchesInfo.cost.length;i++)t(`research${i}`).style.display=e.current===1?"":"none";if(e.current===1){n.name=["Quarks","Particles","Atoms","Molecules"],b.buildingsInfo.cost=[0,3,24,3],b.researchesAutoInfo.cost[1]=3e3,r.scalling[1]=5e3,o.dischargeInfo.next=10**l.discharge.current,t("upgradeCost").classList.add("orangeText"),t("researchCost").classList.add("orangeText");for(let i=1;i<=4;i++)t(`upgrade${i}`).style.display=""}else if(e.current===2){n.name=["Moles","Drops","Puddles","Ponds","Lakes","Seas"],n.increase=1.2,b.buildingsInfo.cost=[0,.0028,100,1e7,9e99,9e99],b.researchesAutoInfo.cost[1]=1e10,r.scalling[1]=1e3,t("upgradeCost").classList.add("cyanText"),t("researchCost").classList.add("cyanText");for(let i=1;i<=o.upgradesS2Info.cost.length;i++)t(`upgradeW${i}`).style.display="";for(let i=1;i<=o.researchesS2Info.cost.length;i++)t(`researchW${i}`).style.display=""}for(let i=1;i<n.name.length;i++)t(`building${i}Name`).textContent=n.name[i],I(i);let a=`upgrades${e.current>1?`S${e.current}`:""}Info`,c=`researches${e.current>1?`S${e.current}`:""}Info`;for(let i=0;i<o[a].cost.length;i++)l.upgrades[i]>1&&(l.upgrades[i]=1,console.error(`Upgrade (${i+1}) had an illegal value`)),x(i,"upgrades");for(let i=0;i<o[c].cost.length;i++)l.researches[i]>o[c].max[i]&&(l.researches[i]=o[c].max[i],console.error(`Research (${i+1}) had level above maxium`)),D(i,"researches"),x(i,"researches");r.max[1]=n.name.length-1;for(let i=0;i<r.cost.length;i++)l.researchesAuto[i]>o.researchesAutoInfo.max[i]&&(l.researchesAuto[i]=o.researchesAutoInfo.max[i],console.error(`Research (${i+1}) for automatization had level above maxium`)),D(i,"researchesAuto"),x(i,"researchesAuto");if(t("researchAuto2Max").textContent=String(r.max[1]),e.current!==1){t("energyStat").style.display="none",t("discharge").style.display="none";for(let i=1;i<=o.upgradesInfo.cost.length;i++)t(`upgrade${i}`).style.display="none"}if(e.current!==2){t("dropStat").style.display="none";for(let i=1;i<=o.upgradesS2Info.cost.length;i++)t(`upgradeW${i}`).style.display="none";for(let i=1;i<=o.researchesS2Info.cost.length;i++)t(`researchW${i}`).style.display="none"}let u=document.body.style;if(t("stageReset").textContent="You are not ready",t("stageWord").textContent=s.word[e.current-1],e.current===1?(u.removeProperty("--border-image"),u.removeProperty("--border-stage"),u.removeProperty("--stage-text-color")):(u.setProperty("--border-image",`url(Used_art/Stage${e.current}%20border.png)`),e.current===2&&(u.setProperty("--border-stage","#1460a8"),u.setProperty("--stage-text-color","dodgerblue"))),o.screenReader){t("invisibleBought").textContent=`Current stage is '${s.word[e.current-1]}'`,t("invisibleGetResource1").style.display=e.current===1?"":"none";for(let i=0;i<n.name.length;i++)t(`invisibleGetBuilding${i}`).textContent=`Get information for ${n.name[i]}`}};var j=(e,s=!1)=>{let{theme:n}=o;s?(n.default=!0,localStorage.removeItem("theme")):(n.default=!1,n.stage=e,localStorage.setItem("theme",String(e))),B()},B=()=>{let{stage:e}=l,{stageInfo:s,theme:n}=o,r=document.body.style;switch(r.setProperty("--transition","1s"),n.default?(n.stage=e.current,t("currentTheme").textContent="Default"):t("currentTheme").textContent=s.word[n.stage-1],r.removeProperty("--background-color"),r.removeProperty("--window-color"),r.removeProperty("--window-border"),r.removeProperty("--footer-color"),r.removeProperty("--button-main-color"),r.removeProperty("--button-main-border"),r.removeProperty("--button-main-hover"),r.removeProperty("--button-extra-hover"),r.removeProperty("--main-text-color"),r.removeProperty("--blue-text-color"),n.stage){case 2:r.setProperty("--background-color","#070026"),r.setProperty("--window-color","#000052"),r.setProperty("--window-border","blue"),r.setProperty("--footer-color","#0000db"),r.setProperty("--button-main-color","blue"),r.setProperty("--button-main-border","#427be1"),r.setProperty("--button-main-hover","#1515cf"),r.setProperty("--button-extra-hover","#2400d7"),r.setProperty("--main-text-color","dodgerblue"),r.setProperty("--blue-text-color","#82cb3b");break}setTimeout(()=>{r.removeProperty("--transition")},1e3)},m=e=>{let s=t("blocker");if(t("blocker").style.display==="block")return console.warn("Wasn't able to show another window (alert)");t("alertText").textContent=e;let n=t("confirmBtn");s.style.display="block";let r=()=>{s.style.display="none",n.removeEventListener("click",r)};n.addEventListener("click",r)},C=async e=>await new Promise(s=>{let n=t("blocker");n.style.display==="block"&&(console.warn("Wasn't able to show another window (confirm)"),s(!1)),t("alertText").textContent=e;let r=t("cancelBtn"),a=t("confirmBtn");n.style.display="block",r.style.display="block";let c=async()=>{n.style.display="none",r.style.display="none",a.removeEventListener("click",c),r.removeEventListener("click",u),s(!0)},u=async()=>{n.style.display="none",r.style.display="none",a.removeEventListener("click",c),r.removeEventListener("click",u),s(!1)};a.addEventListener("click",c),r.addEventListener("click",u)}),Y=async e=>await new Promise(s=>{let n=t("blocker");n.style.display==="block"&&(console.warn("Wasn't able to show another window (prompt)"),s(null)),t("alertText").textContent=e;let r=t("inputArea"),a="",c=t("cancelBtn"),u=t("confirmBtn");n.style.display="block",c.style.display="block",r.style.display="block";let i=()=>{a=r.value},d=async()=>{n.style.display="none",c.style.display="none",r.style.display="none",r.value="",u.removeEventListener("click",d),c.removeEventListener("click",f),r.removeEventListener("blur",i),s(a)},f=async()=>{n.style.display="none",c.style.display="none",r.style.display="none",r.value="",u.removeEventListener("click",d),c.removeEventListener("click",f),r.removeEventListener("blur",i),s(null)};u.addEventListener("click",d),c.addEventListener("click",f),r.addEventListener("blur",i)}),F=()=>{let e=t("footer"),s=t("footerColor"),n=t("hideToggle"),r=t("hideText"),a=t("hideArrow");o.footer=!o.footer,n.removeEventListener("click",F),o.footer?(s.style.display="",a.style.transform="",e.style.animation="hide 1s forwards reverse",a.style.animation="rotate 1s forwards reverse",r.textContent="Hide"):(e.style.animation="hide 1s backwards",a.style.animation="rotate 1s backwards",r.textContent="Show",setTimeout(()=>{s.style.display="none",a.style.transform="rotate(180deg)"},1e3)),setTimeout(()=>{e.style.animation="",a.style.animation="",n.addEventListener("click",F)},1e3)},R=(e=!1,s="toggle",n="building")=>{var r;switch(s){case"toggle":{let a=e,c=Boolean((r=localStorage.getItem("screen reader"))!=null?r:!1),u=t("screenReaderToggle");a&&(c=!c),c?(u.textContent="ON",u.style.borderColor="crimson",u.setAttribute("aria-label","Screen reader support is ON"),localStorage.setItem("screen reader","true"),o.screenReader=!0,n==="reload"&&(l.buyToggle.strict=!1,o.intervals.main=100,o.intervals.numbers=1e3),a&&m(`For full support please refresh page. This will allow to buy upgrades on focus (because I have no idea how to make an image clickable with a keyboard), also you will get a special tab where you can check how much you own and more.
(For non screen readers this will cause issues)`)):(u.textContent="OFF",u.style.borderColor="",u.setAttribute("aria-label","Screen reader support is OFF"),localStorage.removeItem("screen reader"),o.screenReader=!1);break}case"button":{let a=e,{stage:c}=l,u=t("invisibleBought");if(n==="building"){let{buildings:i}=l,{buildingsInfo:d}=o,f=a-1;c.current===2&&a>2&&(f=1),a===0?u.textContent=`You have ${g(i[0].current)} ${d.name[0]}`:u.textContent=`You have ${g(i[a].current)} ${d.name[a]}, next one will cost ${g(d.cost[a])} ${d.name[f]}, they are producing ${g(d.producing[a])} ${d.name[f]} per second${l.researchesAuto[1]>=a?`, auto is ${l.toggles[a+3]?"on":"off"}`:""}`}else c.current===1&&(u.textContent=`You have ${l.energy.current} Energy${l.upgrades[3]===1?`, next discharge goal is ${g(o.dischargeInfo.next)} Energy`:""}`);break}}},W=(e=!1)=>{let s=document.body.style,n=t("customFontSize"),r=localStorage.getItem("fontSize");l.toggles[3]?((r===null||Number(r)<10||Number(r)>32||e)&&(r=String(Math.min(Math.max(Math.trunc(Number(n.value)*10)/10,10),32)),localStorage.setItem("fontSize",r)),s.setProperty("--font-size",`${r}px`),n.value=r):(s.setProperty("--font-size","1em"),localStorage.removeItem("fontSize"))};var l={stage:{true:1,current:1},energy:{current:0,total:0},discharge:{current:0,bonus:0},time:{updated:Date.now(),started:Date.now()},buildings:[{current:3,total:3},{current:0,true:0,total:0},{current:0,true:0,total:0},{current:0,true:0,total:0},{current:0,true:0,total:0},{current:0,true:0,total:0}],upgrades:[0,0,0,0,0,0,0,0],researches:[0,0,0,0,0],researchesAuto:[0,0],toggles:[],buyToggle:{howMany:1,input:10,strict:!0}},o={tab:"stage",footer:!0,screenReader:!1,lastSave:0,energyType:[0,1,5,20],stageInfo:{word:["Microworld","Submerged"],resourceName:["Energy","Water drops"]},theme:{stage:1,default:!0},dischargeInfo:{next:1},intervals:{main:50,numbers:50,visual:1,autoSave:180},intervalsId:{main:0,numbers:0,visual:0,autoSave:0},buildingsInfo:{name:["Quarks","Particles","Atoms","Molecules"],cost:[0,3,24,3],increase:1.4,producing:[0,0,0,0,0,0]},upgradesInfo:{description:["Bigger electrons. Particles cost decreased.","Stronger protons. Particles produce more.","More neutrons. Increased gain of Particles.","Superposition. Unlocks new reset tier.","Protium. Basic.","Deuterium. Heavy.","Tritium. Radioactive.","Nuclear fusion. More energy."],effectText:[["Particle cost is "," times cheaper."],["Particles produce "," times more Quarks."],["Atoms produce "," times more Particles."],["Abbility to reset at any time and boost production for all buildings by ",", if had enough energy."],["Cost scalling is decreased by ","."],["Buildings (only bought one's) boost themselfs by "," times."],["Molecules produce Molecules. At a reduced rate."],["Unspent energy boost Molecules production of themselfs 1 to 1."]],effect:[10,10,5,4,.2,1.01,0,0],cost:[9,12,36,300,800,5e3,15e3,36e3]},upgradesS2Info:{description:["Surface tension. Allows for bigger Puddles.","Streams. Spread quicker.","","Vaporization. Unlock new reset tier.","",""],effectText:[["Each Puddle boost Puddle production by ","."],["Ponds boost to Puddles produtcion is now "," times bigger."],["",""],["Gain ability to convert Drops into Clouds. ("," per 1)"],["",""],["",""]],effect:[1.03,1.5,0,1e10,0,0],cost:[1e3,2e8,0,1e10,0,0]},researchesInfo:{description:["Effect of 'Protium' upgrade is stronger.","Effect of 'Deuterium' upgrade is bigger.","Effect of 'Tritium' upgrade is better.","Discharge bonus improved.","Gain more energy from buying a building."],effectText:[["Cost scalling is "," smaller for each level."],["Each bought building boost each other by additional ","."],["Molecules now produce themselfs "," times quicker."],["Discharge is now gives extra +"," bonus per reached goal."],["A single building now gives "," times more energy."]],effect:[.01,.01,12,1,3],cost:[2e3,6500,2e4,12e3,42e3],scalling:[300,1500,1800,0,81456],max:[9,3,9,1,2]},researchesS2Info:{description:["More moles.","Production of Drops is boosted.","Surface stress."],effectText:[["Drops produce "," times more moles."],["Drops now give boost to what produces them based of bought amount, at a reduced rate."],["Surface tension upgrade is now +"," stronger."]],effect:[3,0,.01],cost:[20,1e9,1e5],scalling:[1.2,0,10],max:[9,1,2]},researchesAutoInfo:{description:["Buy toggles.","Automatization for buying upgrades."],effectText:[["Unlock abbility to buy multiple buildings at same time."],["Will automatically buy "," for you."]],effect:[0,"Particles"],cost:[300,3e3],scalling:[0,5e3],max:[1,3]}},X=e=>{let s=[];for(let n=0;n<e;n++)n>=4&&n<=8?s.push(!1):s.push(!0);return s},Z=document.getElementsByClassName("toggle").length;Object.assign(l,{toggles:X(Z)});var p=structuredClone(l),b=structuredClone(o),z=e=>{let s;return e==="p"?s=structuredClone(p):s=structuredClone(b),s},V=e=>{if(Object.prototype.hasOwnProperty.call(e,"player")&&Object.prototype.hasOwnProperty.call(e,"global")){let s=z("p");for(let a in p)Object.prototype.hasOwnProperty.call(e.player,a)||(e.player[a]=s[a]);let n=`upgrades${e.player.stage.current>1?`S${e.player.stage.current}`:""}Info`,r=`researches${e.player.stage.current>1?`S${e.player.stage.current}`:""}Info`;if(o[n].cost.length>e.player.upgrades.length)for(let a=e.player.upgrades.length;a<o[n].cost.length;a++)e.player.upgrades[a]=0;if(o[r].cost.length>e.player.researches.length)for(let a=e.player.researches.length;a<o[r].cost.length;a++)e.player.researches[a]=0;if(p.buildings.length>e.player.buildings.length)for(let a=e.player.buildings.length;a<p.buildings.length;a++)e.player.buildings[a]={current:0,true:0,total:0};if(p.researchesAuto.length>e.player.researchesAuto.length)for(let a=e.player.researchesAuto.length;a<p.researchesAuto.length;a++)e.player.researchesAuto[a]=0;if(p.toggles.length>e.player.toggles.length)for(let a=e.player.toggles.length;a<p.toggles.length;a++)e.player.toggles[a]=s.toggles[a];Object.assign(l,e.player),o.intervals=e.global.intervals}else m("Save file coudn't be loaded as its missing important info.")};var t=e=>{let s=document.getElementById(e);if(s!==null)return s;throw m("Some ID failed to load, game won't be working properly. Please refresh."),new TypeError(`ID "${e}" not found.`)},q=async(e=!1)=>{if(e){let s=localStorage.getItem("save"),n=localStorage.getItem("theme");if(s!==null){let r=JSON.parse(atob(s));V(r),l.toggles[0]&&m(`Welcome back, you were away for ${g(Date.now()-l.time.updated,0,"time")}.`)}else m("Welcome. This is a test-project. Since I don't expect anyone to play this, save file can get corrupted with a new version.");n!==null&&(o.theme.default=!1,o.theme.stage=Number(n))}R(!1,"toggle","reload"),N(),E(),W();for(let s=0;s<p.toggles.length;s++)H(s,!1);k(),B(),e&&!l.toggles[0]&&await C(`Welcome back, you were away for ${g(Date.now()-l.time.updated,0,"time")}. Game was set to have offline time disabled. Press confirm to NOT to gain offline time.`)&&(l.time.updated=Date.now()),w(!1,"all")};q(!0);var{screenReader:M}=o;for(let e=0;e<p.toggles.length;e++)t(`toggle${e}`).addEventListener("click",()=>H(e));for(let e=1;e<p.buildings.length;e++)t(`building${e}Btn`).addEventListener("click",()=>L(e));for(let e=0;e<o.upgradesInfo.cost.length;e++)t(`upgrade${e+1}`).addEventListener("mouseover",()=>S(e)),t(`upgrade${e+1}`).addEventListener("click",()=>v(e)),M&&t(`upgrade${e+1}`).addEventListener("focus",()=>v(e));for(let e=0;e<o.upgradesS2Info.cost.length;e++)t(`upgradeW${e+1}`).addEventListener("mouseover",()=>S(e)),t(`upgradeW${e+1}`).addEventListener("click",()=>v(e)),M&&t(`upgradeW${e+1}`).addEventListener("focus",()=>v(e));t("dischargeReset").addEventListener("click",async()=>await K());t("stageReset").addEventListener("click",async()=>await _());t("buy1x").addEventListener("click",()=>k("1"));t("buyAny").addEventListener("click",()=>k("any"));t("buyAnyInput").addEventListener("blur",()=>k("any"));t("buyMax").addEventListener("click",()=>k("max"));t("buyStrict").addEventListener("click",()=>k("strict"));for(let e=0;e<o.researchesInfo.cost.length;e++)t(`research${e+1}Image`).addEventListener("mouseover",()=>S(e,"researches")),t(`research${e+1}Image`).addEventListener("click",()=>v(e,"researches")),M&&t(`research${e+1}Image`).addEventListener("focus",()=>v(e,"researches"));for(let e=0;e<o.researchesS2Info.cost.length;e++)t(`researchW${e+1}Image`).addEventListener("mouseover",()=>S(e,"researches")),t(`researchW${e+1}Image`).addEventListener("click",()=>v(e,"researches")),M&&t(`researchW${e+1}Image`).addEventListener("focus",()=>v(e,"researches"));for(let e=0;e<o.researchesAutoInfo.cost.length;e++)t(`researchAuto${e+1}Image`).addEventListener("mouseover",()=>S(e,"researchesAuto")),t(`researchAuto${e+1}Image`).addEventListener("click",()=>v(e,"researchesAuto")),M&&t(`researchAuto${e+1}Image`).addEventListener("focus",()=>v(e,"researchesAuto"));t("save").addEventListener("click",async()=>await P("save"));t("file").addEventListener("change",async()=>await P("load"));t("export").addEventListener("click",async()=>await P("export"));t("delete").addEventListener("click",async()=>await P("delete"));t("switchTheme0").addEventListener("click",()=>j(0,!0));for(let e=1;e<=o.stageInfo.word.length;e++)t(`switchTheme${e}`).addEventListener("click",()=>j(e));t("mainInterval").addEventListener("blur",()=>w(!1,"main"));t("numbersInterval").addEventListener("blur",()=>w(!1,"numbers"));t("visualInterval").addEventListener("blur",()=>w(!1,"visual"));t("autoSaveInterval").addEventListener("blur",()=>w(!1,"autoSave"));t("pauseGame").addEventListener("click",async()=>await ee());t("toggle3").addEventListener("click",()=>W());t("customFontSize").addEventListener("blur",()=>W(!0));t("screenReaderToggle").addEventListener("click",()=>R(!0));if(M){for(let e=0;e<p.buildings.length;e++)t(`invisibleGetBuilding${e}`).addEventListener("click",()=>R(e,"button"));t("invisibleGetResource1").addEventListener("click",()=>R(0,"button","resource")),t("specialTabBtn").addEventListener("click",()=>E("special"))}else t("specialTabBtn").style.display="none";t("hideToggle").addEventListener("click",F);t("stageTabBtn").addEventListener("click",()=>E("stage"));t("researchTabBtn").addEventListener("click",()=>E("research"));t("settingsTabBtn").addEventListener("click",()=>E("settings"));function w(e=!1,s=""){let{intervals:n,intervalsId:r}=o;if(s!==""){let a=t("mainInterval"),c=t("numbersInterval"),u=t("visualInterval"),i=t("autoSaveInterval");if(s==="main")n.main=Math.min(Math.max(Math.trunc(Number(a.value)),20),1e3),n.main>n.numbers&&(n.numbers=n.main);else if(s==="numbers"){let d=Math.min(Math.max(Math.trunc(Number(c.value)),20),1e3);n.numbers=Math.max(d,n.main)}else s==="visual"?n.visual=Math.min(Math.max(Math.trunc(Number(u.value)*10)/10,.5),10):s==="autoSave"&&(n.autoSave=Math.min(Math.max(Math.trunc(Number(i.value)),60),1800));a.value=String(n.main),c.value=String(n.numbers),u.value=String(n.visual),i.value=String(n.autoSave)}clearInterval(r.main),clearInterval(r.numbers),clearInterval(r.visual),clearInterval(r.autoSave),e||(r.main=setInterval(U,n.main),r.numbers=setInterval($,n.numbers),r.visual=setInterval(A,n.visual*1e3),r.autoSave=setInterval(P,n.autoSave*1e3,"save"))}async function P(e){switch(e){case"load":{let s=t("file"),n=s.files;if(n===null)return m("Loaded file wasn't found.");let r=await n[0].text();try{let a=JSON.parse(atob(r));w(!0),V(a),l.toggles[0]||await C(`This save file was set to have offline progress disabled (currently ${g(Date.now()-l.time.updated,0,"time")}). Press confirm to NOT to gain offline time.`)&&(l.time.updated=Date.now()),q()}catch(a){m("Incorrect save file format.")}finally{s.value=""}break}case"save":{let s=btoa(`{"player":${JSON.stringify(l)},"global":{"intervals":${JSON.stringify(o.intervals)}}}`);localStorage.setItem("save",s),t("isSaved").textContent="Saved",o.lastSave=0;break}case"export":{await P("save");let s=localStorage.getItem("save");if(s===null)return m("Save file wasn't found. Even though game was saved just now...");let n=document.createElement("a");n.href="data:text/plain;charset=utf-8,"+s,n.download="Fundamental.txt",n.click();break}case"delete":{let s=await Y(`This will truly delete your save file!
Type 'delete' to confirm.`);(s==null?void 0:s.toLowerCase())==="delete"?(w(!0),localStorage.clear(),Object.assign(l,z("p")),Object.assign(o,z("g")),l.time.started=Date.now(),l.time.updated=l.time.started,q()):s!==null&&s!==""&&m(`You wrote '${s}', so save file wasn't deleted.`);break}}}var ee=async()=>{w(!0);let e=await Y("Game is currently paused. Press any button bellow to unpause it. If you want you can enter 'NoOffline' to NOT to gain offline time. Offline timer has a limit.");(e==null?void 0:e.toLowerCase())==="nooffline"?l.time.updated=Date.now():e!==null&&e!==""&&m(`You wrote '${e}', so you gained offline time.`),w()};})();
